<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–∫—Å - –ü–ª–∞–Ω –Ω–∞ 2026 –≥–æ–¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(135deg, #6bcf7f 0%, #4ecdc4 100%);
            transition: width 0.5s ease;
            z-index: 0;
        }

        header > * {
            position: relative;
            z-index: 1;
        }

        .header-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
        }

        .header-left,
        .header-right {
            text-align: left;
        }

        .header-center {
            text-align: center;
        }

        .header-right {
            text-align: right;
        }

        .header-cost-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .header-cost-value {
            font-size: 1.2em;
            font-weight: 700;
        }

        header h1 {
            font-size: 1.5em;
            margin: 0;
        }

        .header-nav {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
        }

        .header-nav a {
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 6px;
            transition: all 0.3s;
            opacity: 0.9;
        }

        .header-nav a:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .header-nav a.active {
            opacity: 1;
            background: rgba(255, 255, 255, 0.3);
            text-decoration: underline;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .schedule-cell {
            transition: all 0.2s;
            cursor: text;
            min-height: 40px;
        }

        .schedule-cell:hover {
            background: rgba(102, 126, 234, 0.1) !important;
            box-shadow: inset 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .schedule-cell:focus {
            outline: none;
            background: rgba(102, 126, 234, 0.15) !important;
            box-shadow: inset 0 0 0 2px #667eea;
        }

        .schedule-main-action {
            font-weight: 700;
            font-size: 1em;
            margin-bottom: 4px;
        }

        .schedule-sub-action {
            font-size: 0.85em;
            color: #555;
            margin-left: 15px;
            margin-top: 2px;
            font-style: italic;
        }

        .schedule-cell-multiline {
            text-align: left !important;
            padding: 10px 12px !important;
            vertical-align: top;
        }

        .time-main {
            font-weight: 600;
        }

        .time-sub {
            font-style: italic;
            font-weight: normal;
            font-size: 0.9em;
            color: #666;
            margin-top: 2px;
        }

        .schedule-main-action {
            text-align: center;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .schedule-sub-action {
            text-align: right;
            font-style: italic;
            font-size: 0.9em;
            color: #555;
            margin-top: 2px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–∞ */
        .diary-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
        }

        .diary-form {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .diary-form textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            margin-bottom: 12px;
        }

        .diary-form textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .diary-form button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .diary-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .diary-entries {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .diary-entry {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .diary-entry:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateX(5px);
        }

        .diary-entry-date {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .diary-entry-text {
            font-size: 1em;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .diary-entry-actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }

        .diary-entry-actions button {
            background: #f0f0f0;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: background 0.2s;
        }

        .diary-entry-actions button:hover {
            background: #e0e0e0;
        }

        .diary-entry-actions .delete-btn {
            background: #ffe0e0;
            color: #c00;
        }

        .diary-entry-actions .delete-btn:hover {
            background: #ffcccc;
        }

        .diary-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .diary-entry-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #555;
        }

        /* AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π */
        .diary-entry-ai-comment {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .diary-entry-ai-comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .diary-entry-ai-comment-header:hover {
            opacity: 0.8;
        }

        .diary-entry-ai-comment-title {
            font-weight: 600;
            color: #667eea;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .diary-entry-ai-comment-toggle {
            color: #999;
            font-size: 0.85em;
        }

        .diary-entry-ai-comment-content {
            margin-top: 15px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .diary-entry-ai-comment-content.collapsed {
            display: none;
        }

        .diary-entry-ai-comment-loading {
            color: #999;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .diary-entry-ai-feedback {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .diary-entry-ai-feedback button {
            background: #f0f0f0;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .diary-entry-ai-feedback button:hover {
            background: #e0e0e0;
        }

        .diary-entry-ai-feedback button.liked {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .diary-entry-ai-feedback button.disliked {
            background: #ffebee;
            color: #c62828;
        }

        .progress-bar-container {
            width: 80px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #6bcf7f 0%, #4ecdc4 100%);
            transition: width 0.5s ease-in-out;
        }

        .progress-text {
            white-space: nowrap;
        }

        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–∞ */
        @media (max-width: 768px) {
            .diary-entry-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .diary-entry-progress {
                width: 100%;
                justify-content: flex-end;
            }
        }


        /* –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ */
        .goal-item {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .goal-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .goal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .goal-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .goal-title {
            font-size: 1.3em;
            font-weight: 600;
            flex: 1;
        }

        .goal-progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            border-radius: 4px;
        }

        .goal-progress-text {
            text-align: right;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .goal-subtasks {
            margin-top: 15px;
            padding-left: 40px;
            display: none;
        }

        .goal-item.expanded .goal-subtasks {
            display: block;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .subtask-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .expand-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px 10px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .goal-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }

        .goal-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-section {
            margin-bottom: 20px;
        }

        .card-section label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9em;
        }

        .card-section textarea,
        .card-section input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .card-section textarea:focus,
        .card-section input:focus {
            outline: none;
            border-color: #667eea;
        }

        .card-section textarea {
            min-height: 80px;
        }

        .subtasks-list {
            list-style: none;
        }

        .subtasks-list li {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }

        .add-subtask {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .add-subtask:hover {
            background: #5568d3;
        }

        /* –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-not_started {
            background: #ffe0e0;
            color: #c00;
        }

        .status-in_progress {
            background: #fff4e0;
            color: #f90;
        }

        .status-completed {
            background: #e0ffe0;
            color: #0a0;
        }

        .table-progress-bar {
            width: 100px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            display: inline-block;
            margin-right: 10px;
        }

        .table-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
        }

        .editable {
            cursor: text;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .editable:hover {
            background: #f0f0f0;
        }

        .editable:focus {
            background: #fff;
            outline: 2px solid #667eea;
        }

        .priority-select {
            padding: 5px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
        }

        footer {
            background: #f5f5f5;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }


        /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –ú–∞—Å–ª–æ—É */
        .maslow-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 10px;
            text-transform: uppercase;
        }

        .maslow-1 {
            background: #ff6b6b;
            color: white;
        }

        .maslow-2 {
            background: #ffa94d;
            color: white;
        }

        .maslow-3 {
            background: #ffd93d;
            color: #333;
        }

        .maslow-4 {
            background: #6bcf7f;
            color: white;
        }

        .maslow-5 {
            background: #a78bfa;
            color: white;
        }

        .maslow-6 {
            background: #f5576c;
            color: white;
        }

        .maslow-7 {
            background: #4ecdc4;
            color: white;
        }

        .goal-item.maslow-1 {
            border-left-color: #ff6b6b;
        }

        .goal-item.maslow-2 {
            border-left-color: #ffa94d;
        }

        .goal-item.maslow-3 {
            border-left-color: #ffd93d;
        }

        .goal-item.maslow-4 {
            border-left-color: #6bcf7f;
        }

        .goal-item.maslow-5 {
            border-left-color: #a78bfa;
        }

        .goal-item.maslow-6 {
            border-left-color: #f5576c;
        }

        .goal-item.maslow-7 {
            border-left-color: #4ecdc4;
        }

        .goal-card.maslow-1 {
            border-color: #ff6b6b;
        }

        .goal-card.maslow-2 {
            border-color: #ffa94d;
        }

        .goal-card.maslow-3 {
            border-color: #ffd93d;
        }

        .goal-card.maslow-4 {
            border-color: #6bcf7f;
        }

        .goal-card.maslow-5 {
            border-color: #a78bfa;
        }

        .goal-card.maslow-6 {
            border-color: #f5576c;
        }

        .goal-card.maslow-7 {
            border-color: #4ecdc4;
        }

        /* –ü–∏—Ä–∞–º–∏–¥–∞ –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞ */
        .maslow-pyramid {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .pyramid-title {
            text-align: center;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .pyramid-levels {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 3px;
            margin-top: 20px;
        }

        .pyramid-level {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            color: white;
            font-weight: 700;
            font-size: 0.9em;
            padding: 10px 12px;
            border-radius: 8px;
            min-width: 90%;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .pyramid-level:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* –°—Ç–∞—Ä—ã–µ CSS –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è level-1 –¥–æ level-7 —É–¥–∞–ª–µ–Ω—ã - —Ç–µ–ø–µ—Ä—å —Ü–≤–µ—Ç–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ */

        .level-title {
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: center;
        }

        .level-goals {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .level-goals-header {
            display: grid;
            grid-template-columns: 2fr 60px 50px 70px 80px;
            gap: 5px;
            padding: 6px 8px;
            font-size: 0.7em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        .level-goals-header span:last-child {
            text-align: right;
        }

        .level-goal-item {
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            gap: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .level-goal-item:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .level-goal-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .level-goal-price,
        .level-goal-quantity,
        .level-goal-total {
            font-size: 0.9em;
            color: #666;
        }

        .level-goal-price input,
        .level-goal-quantity input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: right;
        }

        .level-goal-total {
            font-weight: 600;
            color: #2c3e50;
            text-align: right;
        }

        .level-goal-progress {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Ü–µ–ª–∏ */
        .level-goal-main-row {
            display: grid;
            grid-template-columns: 2fr 60px 50px 70px 80px auto;
            gap: 5px;
            align-items: center;
            width: 100%;
        }
        
        .level-goals-header {
            display: grid;
            grid-template-columns: 2fr 60px 50px 70px 80px auto;
            gap: 5px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —à–∞–≥–æ–≤ */
        .steps-toggle-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            color: #667eea;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .steps-toggle-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .steps-toggle-icon {
            transition: transform 0.2s;
            font-size: 0.8em;
        }
        
        .steps-toggle-btn[aria-expanded="true"] .steps-toggle-icon {
            transform: rotate(180deg);
        }
        
        .steps-toggle-text {
            font-weight: 500;
        }
        
        /* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω –¥–ª—è —à–∞–≥–æ–≤ */
        .goal-steps-accordion {
            grid-column: 1 / -1;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —à–∞–≥–æ–≤ —Ü–µ–ª–µ–π */
        .goal-steps-container {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        
        .goal-steps-header {
            font-size: 0.85em;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .goal-steps-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .goal-step-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 4px;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .goal-step-item:hover {
            background: rgba(0, 0, 0, 0.06);
        }
        
        .goal-step-item.completed {
            opacity: 0.7;
        }
        
        .goal-step-item.completed .step-name {
            text-decoration: line-through;
            color: #888;
        }
        
        .goal-step-item.in-progress {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .step-checkbox {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .step-icon {
            font-size: 1.1em;
        }
        
        .step-name {
            flex: 1;
            color: #333;
        }
        
        .step-progress {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
            text-align: right;
        }


        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                border-radius: 10px;
            }

            header {
                padding: 10px;
            }

            .header-content {
                grid-template-columns: 1fr;
                gap: 8px;
                text-align: center;
            }

            .header-left,
            .header-right {
                text-align: center;
            }

            header h1 {
                font-size: 1.2em;
            }

            .header-cost-label {
                font-size: 0.75em;
            }

            .header-cost-value {
                font-size: 1em;
            }

            .header-nav {
            gap: 10px;
                margin-top: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

            .header-nav a {
            font-size: 0.9em;
                padding: 6px 12px;
                min-height: 44px; /* —É–¥–æ–±–Ω—ã–π —Ç–∞—á-—Ç–∞—Ä–≥–µ—Ç */
                display: inline-flex;
            align-items: center;
            }

            .maslow-pyramid {
                padding: 10px;
                border-radius: 8px;
            }

            .pyramid-title {
            font-size: 1.1em;
                margin-bottom: 10px;
            }

            .pyramid-level {
                padding: 8px 10px;
                font-size: 0.8em;
                border-radius: 6px;
            }

            .level-title {
                font-size: 0.9em;
                margin-bottom: 6px;
            }

            .level-goals-header {
                display: none;
        }

        .level-goal-item {
                grid-template-columns: 1fr;
                gap: 4px;
                padding: 6px 8px;
            }

            .level-goal-title {
                font-size: 0.85em;
                margin-bottom: 4px;
            }

            .level-goal-price,
            .level-goal-quantity,
            .level-goal-total,
            .level-goal-progress {
                font-size: 0.75em;
            display: flex;
            justify-content: space-between;
            }

            .level-goal-price::before {
                content: "–¶–µ–Ω–∞: ";
            }

            .level-goal-quantity::before {
                content: "–ö–æ–ª-–≤–æ: ";
            }

            .level-goal-total::before {
                content: "–°—É–º–º–∞: ";
            }

            .level-goal-progress::before {
                content: "–ü—Ä–æ–≥—Ä–µ—Å—Å: ";
            }

            #schedule-section {
                padding: 10px !important;
            }

            #schedule-section h2 {
                font-size: 1.3em !important;
                margin-bottom: 15px !important;
            }

            #schedule-table {
                font-size: 0.75em;
            }

            #schedule-table th,
            #schedule-table td {
                padding: 6px 4px !important;
                min-width: 80px !important;
            }

            .schedule-cell {
                font-size: 0.8em;
                min-height: 30px;
            }

            .schedule-main-action {
            font-size: 0.85em;
            }

            .schedule-sub-action {
                font-size: 0.7em;
            }

            .time-main {
                font-size: 0.85em;
            }

            .time-sub {
                font-size: 0.7em;
            }

            .diary-container {
                padding: 10px;
            }

            .diary-form {
                padding: 15px;
            }

            .diary-form textarea {
                min-height: 120px;
            font-size: 0.9em;
            }

            .diary-entry {
                padding: 15px;
            }

            .diary-entry-date {
                font-size: 0.8em;
            }

            .diary-entry-text {
                font-size: 0.9em;
            }

            .diary-entry-actions button {
                font-size: 0.75em;
                padding: 5px 10px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 2px;
            }

            header h1 {
                font-size: 1em;
            }

            .header-nav {
                gap: 6px;
            }

            .header-nav a {
                padding: 6px 10px;
                font-size: 0.85em;
            }

            .header-cost-value {
                font-size: 0.9em;
            }

            .header-right button {
                font-size: 0.65em !important;
                padding: 4px 6px !important;
                margin-top: 4px !important;
            }

            .pyramid-level {
                font-size: 0.75em;
                padding: 6px 8px;
            }

            .level-goal-item {
                padding: 4px 6px;
            }

            #schedule-table {
                font-size: 0.65em;
            }

            #schedule-table th,
            #schedule-table td {
                padding: 4px 2px !important;
                min-width: 60px !important;
            }

            .diary-container {
                padding: 5px;
            }

            .diary-form {
                padding: 10px;
            }

            .diary-form textarea {
                min-height: 100px;
                font-size: 0.85em;
            }

            .diary-entry {
                padding: 12px;
            }

            .diary-entry-date {
                font-size: 0.75em;
            }

            .diary-entry-text {
                font-size: 0.85em;
            }

            .diary-entry-actions {
                flex-direction: column;
                gap: 5px;
            }

            .diary-entry-actions button {
                font-size: 0.7em;
                padding: 4px 8px;
                width: 100%;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–æ–¥–æ–≤–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞ –ø—Ä–∏–≤—ã—á–µ–∫ */
        #year-tracker-table thead th {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            z-index: 10;
            white-space: nowrap;
        }

        #year-tracker-table thead th.month-header {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            font-weight: 700;
            font-size: 12px;
        }

        #year-tracker-table tbody td:first-child,
        #year-tracker-table tbody td:nth-child(2),
        #year-tracker-table tbody td:nth-child(3),
        #year-tracker-table tbody td:nth-child(4),
        #year-tracker-table tbody td:nth-child(5) {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 6px 4px;
            position: sticky;
            z-index: 5;
        }

        #year-tracker-table tbody td:first-child {
            width: 40px;
            text-align: center;
            font-weight: 600;
            color: #64748b;
            left: 0;
        }

        #year-tracker-table tbody td:nth-child(2),
        #year-tracker-table tbody td:nth-child(3) {
            width: 70px;
            text-align: center;
            font-size: 11px;
            color: #475569;
        }

        #year-tracker-table tbody td:nth-child(2) {
            left: 40px;
        }

        #year-tracker-table tbody td:nth-child(3) {
            left: 110px;
        }

        #year-tracker-table tbody td:nth-child(4) {
            width: 140px;
            text-align: left;
            color: #4338ca;
            font-weight: 600;
            left: 180px;
        }

        #year-tracker-table tbody td:nth-child(5) {
            width: 200px;
            text-align: left;
            font-weight: 600;
            color: #111827;
            left: 320px;
        }

        #year-tracker-table tbody td:nth-child(n+6):not(:last-child) {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 6px 4px;
            text-align: center;
            min-width: 28px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #year-tracker-table tbody td:last-child {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 6px 4px;
            text-align: center;
            font-weight: 600;
            min-width: 60px;
        }

        #year-tracker-table tbody td:not(:first-child):hover {
            background: rgba(102, 126, 234, 0.1);
        }

        #year-tracker-table tbody td.cell-done {
            background: #dcfce7;
            color: #065f46;
            font-weight: 600;
        }

        #year-tracker-table tbody td.cell-empty {
            background: #f8fafc;
        }

        #year-tracker-table tbody td.cell-inactive {
            background: #e5e7eb;
            color: #6b7280;
            cursor: default;
        }

        #year-tracker-table tbody td.cell-done {
            background: #dcfce7;
            color: #065f46;
            font-weight: 600;
        }

        #year-tracker-table tbody td.cell-done:after {
            content: '‚úì';
        }

        #year-tracker-table .day-number {
            font-weight: 600;
            color: #111827;
            font-size: 11px;
        }

        #year-tracker-table .day-weekday {
            font-size: 9px;
            color: #64748b;
            margin-top: 2px;
        }

        #year-tracker-table .weekend {
            background: #fef3c7 !important;
        }

        #year-tracker-table .weekend .day-number {
            color: #92400e;
        }

        #year-tracker-table .today-cell {
            background: #fef3c7 !important;
            box-shadow: 0 0 0 2px rgba(251, 146, 60, 0.35) inset;
            font-weight: 700;
        }

        #year-tracker-table tfoot td {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 8px 4px;
            text-align: center;
            font-weight: 600;
        }

        #year-tracker-table tfoot td:nth-child(5) {
            text-align: left;
            padding-left: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header id="mainHeader">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-cost-label">üí∞ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ü–µ–ª–µ–π</div>
                    <div class="header-cost-value" id="totalCost">0 ‚ÇΩ</div>
                </div>
                <div class="header-center">
            <h1>üéØ –ü–ª–∞–Ω –Ω–∞ 2026 –≥–æ–¥</h1>
                    <div class="header-nav">
                        <a href="#" onclick="showSection('pyramid'); return false;" class="active" id="nav-pyramid">–ü–∏—Ä–∞–º–∏–¥–∞</a>
                        <a href="#" onclick="showSection('schedule'); return false;" id="nav-schedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
                        <a href="#" onclick="showSection('diary'); return false;" id="nav-diary">–î–Ω–µ–≤–Ω–∏–∫</a>
                        <a href="#" onclick="showSection('today'); return false;" id="nav-today">–°–µ–≥–æ–¥–Ω—è</a>
            </div>
        </div>
                <div class="header-right">
                    <div class="header-cost-label">üìà –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–æ—Ö–æ–¥</div>
                    <div class="header-cost-value" id="requiredIncome">0 ‚ÇΩ</div>
                </div>
            </div>
        </header>

        <!-- –ü–∏—Ä–∞–º–∏–¥–∞ –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞ -->
        <div id="pyramid-section" class="content-section active">
        <div class="maslow-pyramid">
            <div class="pyramid-title">üèîÔ∏è –ü–∏—Ä–∞–º–∏–¥–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞</div>
            <div class="pyramid-levels" id="pyramid-levels-container">
                <!-- –†–∞–∑–¥–µ–ª—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –ë–î -->
            </div>
                    </div>
                </div>

        <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
        <div id="schedule-section" class="content-section">
            <div style="padding: 15px;">
                <h2 style="font-size: 1.5em; margin-bottom: 15px; color: #2c3e50; text-align: center;">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                
                <div style="overflow-x: auto;">
                    <table id="schedule-table" style="width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                    <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 15px; text-align: left; font-weight: 600; min-width: 120px;">–í—Ä–µ–º—è</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–í—Ç–æ—Ä–Ω–∏–∫</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–°—Ä–µ–¥–∞</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–ß–µ—Ç–≤–µ—Ä–≥</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–ü—è—Ç–Ω–∏—Ü–∞</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–°—É–±–±–æ—Ç–∞</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; min-width: 150px;">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</th>
                        </tr>
                    </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:00</td>
                                <td class="schedule-cell" data-day="monday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #fff3cd;">–ü–æ–¥—ä—ë–º</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #fff3cd;">–ü–æ–¥—ä—ë–º</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #fff3cd;">–ü–æ–¥—ä—ë–º</td>
                                <td class="schedule-cell" data-day="thursday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #fff3cd;">–ü–æ–¥—ä—ë–º</td>
                                <td class="schedule-cell" data-day="friday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #fff3cd;">–ü–æ–¥—ä—ë–º</td>
                                <td class="schedule-cell" data-day="saturday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="7:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:00-7:30</td>
                                <td class="schedule-cell" data-day="monday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                <td class="schedule-cell" data-day="thursday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                <td class="schedule-cell" data-day="friday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                <td class="schedule-cell" data-day="saturday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="7:00-7:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">8:00-9:00</td>
                                <td class="schedule-cell" data-day="monday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–ó–∞—Ä—è–¥–∫–∞</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–ó–∞—Ä—è–¥–∫–∞</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–ó–∞—Ä—è–¥–∫–∞</td>
                                <td class="schedule-cell" data-day="thursday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–ó–∞—Ä—è–¥–∫–∞</td>
                                <td class="schedule-cell" data-day="friday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–ó–∞—Ä—è–¥–∫–∞</td>
                                <td class="schedule-cell" data-day="saturday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="8:00-9:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">9:00-10:00</td>
                                <td class="schedule-cell" data-day="monday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–£—á—ë–±–∞</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–£—á—ë–±–∞</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–£—á—ë–±–∞</td>
                                <td class="schedule-cell" data-day="thursday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–£—á—ë–±–∞</td>
                                <td class="schedule-cell" data-day="friday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–£—á—ë–±–∞</td>
                                <td class="schedule-cell" data-day="saturday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="9:00-10:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; background: #f8f9fa; border-right: 2px solid #e0e0e0;">
                                    <div class="time-main">10:00-19:00</div>
                                    <div class="time-sub">14:00-15:00</div>
                                    <div class="time-sub">15:00-17:00</div>
                                </td>
                                <td class="schedule-cell" data-day="monday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; background: #f8d7da; vertical-align: top;">
                                    <div class="schedule-main-action">–†–∞–±–æ—Ç–∞</div>
                                    <div class="schedule-sub-action">- –æ–±–µ–¥</div>
                                    <div class="schedule-sub-action">- –∫–Ω–∏–≥–∞</div>
                                </td>
                                <td class="schedule-cell" data-day="tuesday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; background: #f8d7da; vertical-align: top;">
                                    <div class="schedule-main-action">–†–∞–±–æ—Ç–∞</div>
                                    <div class="schedule-sub-action">- –æ–±–µ–¥</div>
                                    <div class="schedule-sub-action">- –∫–Ω–∏–≥–∞</div>
                                </td>
                                <td class="schedule-cell" data-day="wednesday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; background: #f8d7da; vertical-align: top;">
                                    <div class="schedule-main-action">–†–∞–±–æ—Ç–∞</div>
                                    <div class="schedule-sub-action">- –æ–±–µ–¥</div>
                                    <div class="schedule-sub-action">- –∫–Ω–∏–≥–∞</div>
                                </td>
                                <td class="schedule-cell" data-day="thursday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; background: #f8d7da; vertical-align: top;">
                                    <div class="schedule-main-action">–†–∞–±–æ—Ç–∞</div>
                                    <div class="schedule-sub-action">- –æ–±–µ–¥</div>
                                    <div class="schedule-sub-action">- –∫–Ω–∏–≥–∞</div>
                                </td>
                                <td class="schedule-cell" data-day="friday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; background: #f8d7da; vertical-align: top;">
                                    <div class="schedule-main-action">–†–∞–±–æ—Ç–∞</div>
                                    <div class="schedule-sub-action">- –æ–±–µ–¥</div>
                                    <div class="schedule-sub-action">- –∫–Ω–∏–≥–∞</div>
                                </td>
                                <td class="schedule-cell" data-day="saturday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; vertical-align: top;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="10:00-19:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; vertical-align: top;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">19:00-20:30</td>
                                <td class="schedule-cell" data-day="monday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                <td class="schedule-cell" data-day="thursday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                <td class="schedule-cell" data-day="friday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d1ecf1;">–£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                <td class="schedule-cell" data-day="saturday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="19:00-20:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">20:30-22:30</td>
                                <td class="schedule-cell" data-day="monday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–û—Å—Ç—Ä–æ–≤</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–û—Å—Ç—Ä–æ–≤</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–û—Å—Ç—Ä–æ–≤</td>
                                <td class="schedule-cell" data-day="thursday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–û—Å—Ç—Ä–æ–≤</td>
                                <td class="schedule-cell" data-day="friday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #d4edda;">–û—Å—Ç—Ä–æ–≤</td>
                                <td class="schedule-cell" data-day="saturday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="20:30-22:30" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">22:30-23:00</td>
                                <td class="schedule-cell" data-day="monday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                <td class="schedule-cell" data-day="thursday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                <td class="schedule-cell" data-day="friday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #cfe2ff;">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                <td class="schedule-cell" data-day="saturday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="22:30-23:00" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">23:00-23:20</td>
                                <td class="schedule-cell" data-day="monday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #f8d7da;">–î—ã—Ö–∞–Ω–∏–µ</td>
                                <td class="schedule-cell" data-day="tuesday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #f8d7da;">–î—ã—Ö–∞–Ω–∏–µ</td>
                                <td class="schedule-cell" data-day="wednesday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #f8d7da;">–î—ã—Ö–∞–Ω–∏–µ</td>
                                <td class="schedule-cell" data-day="thursday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #f8d7da;">–î—ã—Ö–∞–Ω–∏–µ</td>
                                <td class="schedule-cell" data-day="friday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center; background: #f8d7da;">–î—ã—Ö–∞–Ω–∏–µ</td>
                                <td class="schedule-cell" data-day="saturday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                                <td class="schedule-cell" data-day="sunday" data-time="23:00-23:20" contenteditable="true" style="padding: 12px; border: 1px solid #e0e0e0; text-align: center;"></td>
                            </tr>
                        </tbody>
                </table>
                    </div>
                    
                    <!-- –î–í–ê –í–ê–†–ò–ê–ù–¢–ê –†–ê–°–ü–ò–°–ê–ù–ò–Ø -->
                    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                        <h3 style="font-size: 1.3em; margin-bottom: 25px; color: #2c3e50; text-align: center;">üìã –î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h3>
                        
                        <!-- –í–ê–†–ò–ê–ù–¢ 1: –° –ò–ù–¢–ï–†–í–ê–õ–¨–ù–´–ú –ü–ò–¢–ê–ù–ò–ï–ú -->
                        <div style="margin-bottom: 40px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-left: 5px solid #667eea;">
                            <h4 style="font-size: 1.1em; margin-bottom: 20px; color: #667eea; text-align: center; font-weight: 600;">‚úÖ –í–ê–†–ò–ê–ù–¢ 1: –° –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–º –ø–∏—Ç–∞–Ω–∏–µ–º (–±–µ–∑ –∑–∞–≤—Ç—Ä–∞–∫–∞)</h4>
                            
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; font-size: 0.9em;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                            <th style="padding: 12px; text-align: left; font-weight: 600; min-width: 100px;">–í—Ä–µ–º—è</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ü–Ω</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–í—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–°—Ä</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ß—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ü—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–°–±</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–í—Å</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">23:00-7:00</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #e3f2fd; border: 1px solid #e0e0e0;">üò¥ –°–û–ù (8 —á–∞—Å–æ–≤)</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">6:00-7:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #f8f9fa; border: 1px solid #e0e0e0;">‚Äî</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å –ö–ü</td>
                                            <td style="padding: 10px; text-align: center; background: #f8f9fa; border: 1px solid #e0e0e0;">‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:00-7:30</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üöø –¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:30-8:00</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ (–∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ)</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">8:00-9:00</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">9:00-10:00</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">10:00-11:00</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">11:00-12:00</td>
                                            <td style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å –û–ª—å–≥–æ–π</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">12:00-19:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0; vertical-align: top;">
                                                <div style="font-weight: 600; margin-bottom: 5px;">üíº –†–∞–±–æ—Ç–∞</div>
                                                <div style="font-size: 0.85em; color: #666;">14:00-15:00 ‚Äî –û–±–µ–¥</div>
                                                <div style="font-size: 0.85em; color: #666;">15:00-17:00 ‚Äî –ö–Ω–∏–≥–∞</div>
                                            </td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">19:00-20:30</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å —á–µ–º–ø–∏–æ–Ω–∞–º–∏ + —É–∂–∏–Ω</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">20:30-22:30</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0;">üèùÔ∏è –û—Å—Ç—Ä–æ–≤</td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">22:30-23:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0;">üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr style="background: #fff3cd;">
                                            <td style="padding: 10px; font-weight: 600; border-right: 2px solid #e0e0e0;">‚ö†Ô∏è –ï–∂–µ–¥–Ω–µ–≤–Ω–æ</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; border: 1px solid #e0e0e0; font-style: italic; color: #856404;">
                                                –°–∏–í (15 –º–∏–Ω) + –ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –Ω–∞ –≥–∏—Ç–∞—Ä–µ (15 –º–∏–Ω) ‚Äî –º–µ—Å—Ç–æ –µ—â—ë –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- –í–ê–†–ò–ê–ù–¢ 2: –° –ó–ê–í–¢–†–ê–ö–û–ú -->
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-left: 5px solid #28a745;">
                            <h4 style="font-size: 1.1em; margin-bottom: 20px; color: #28a745; text-align: center; font-weight: 600;">üç≥ –í–ê–†–ò–ê–ù–¢ 2: –° –∑–∞–≤—Ç—Ä–∞–∫–æ–º (–æ–±—ã—á–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ)</h4>
                            
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; font-size: 0.9em;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                                            <th style="padding: 12px; text-align: left; font-weight: 600; min-width: 100px;">–í—Ä–µ–º—è</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ü–Ω</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–í—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–°—Ä</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ß—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–ü—Ç</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–°–±</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; min-width: 140px;">–í—Å</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">23:00-7:00</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #e3f2fd; border: 1px solid #e0e0e0;">üò¥ –°–û–ù (8 —á–∞—Å–æ–≤)</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">6:00-7:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #f8f9fa; border: 1px solid #e0e0e0;">‚Äî</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å –ö–ü</td>
                                            <td style="padding: 10px; text-align: center; background: #f8f9fa; border: 1px solid #e0e0e0;">‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:00-7:30</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üöø –¢—É–∞–ª–µ—Ç/–¥—É—à</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">7:30-8:00</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0; font-weight: 600;">üç≥ –ó–∞–≤—Ç—Ä–∞–∫</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">8:00-9:00</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0; font-weight: 600;">üèÉ –ü—Ä–æ–±–µ–∂–∫–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">9:00-10:00</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">10:00-11:00</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">11:00-12:00</td>
                                            <td style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å –û–ª—å–≥–æ–π</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0;">üíº –†–∞–±–æ—Ç–∞</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">12:00-19:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #f8d7da; border: 1px solid #e0e0e0; vertical-align: top;">
                                                <div style="font-weight: 600; margin-bottom: 5px;">üíº –†–∞–±–æ—Ç–∞</div>
                                                <div style="font-size: 0.85em; color: #666;">14:00-15:00 ‚Äî –û–±–µ–¥</div>
                                                <div style="font-size: 0.85em; color: #666;">15:00-17:00 ‚Äî –ö–Ω–∏–≥–∞</div>
                                            </td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">19:00-20:30</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0; font-weight: 600;">üìû –°–æ–∑–≤–æ–Ω —Å —á–µ–º–ø–∏–æ–Ω–∞–º–∏ + —É–∂–∏–Ω</td>
                                            <td style="padding: 10px; text-align: center; background: #d1ecf1; border: 1px solid #e0e0e0;">üçΩÔ∏è –£–∂–∏–Ω/–û—Ç–¥—ã—Ö</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                            <td style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">20:30-22:30</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #d4edda; border: 1px solid #e0e0e0;">üèùÔ∏è –û—Å—Ç—Ä–æ–≤</td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 10px; font-weight: 600; background: #f8f9fa; border-right: 2px solid #e0e0e0;">22:30-23:00</td>
                                            <td colspan="5" style="padding: 10px; text-align: center; background: #cfe2ff; border: 1px solid #e0e0e0;">üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è</td>
                                            <td colspan="2" style="padding: 10px; text-align: center; background: #fff3cd; border: 1px solid #e0e0e0;">‚è∞ –°–≤–æ–±–æ–¥–Ω–æ</td>
                                        </tr>
                                        <tr style="background: #fff3cd;">
                                            <td style="padding: 10px; font-weight: 600; border-right: 2px solid #e0e0e0;">‚ö†Ô∏è –ï–∂–µ–¥–Ω–µ–≤–Ω–æ</td>
                                            <td colspan="7" style="padding: 10px; text-align: center; border: 1px solid #e0e0e0; font-style: italic; color: #856404;">
                                                –°–∏–í (15 –º–∏–Ω) + –ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –Ω–∞ –≥–∏—Ç–∞—Ä–µ (15 –º–∏–Ω) ‚Äî –º–µ—Å—Ç–æ –µ—â—ë –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
            </div>
        </div>

        <!-- –î–Ω–µ–≤–Ω–∏–∫ -->
        <div id="diary-section" class="content-section">
            <div class="diary-container">
                <h2 style="font-size: 1.5em; margin-bottom: 20px; color: #2c3e50; text-align: center;">üìî –î–Ω–µ–≤–Ω–∏–∫</h2>
                
                <div class="diary-form">
                    <textarea id="diary-text" placeholder="–ß—Ç–æ —É —Ç–µ–±—è –Ω–∞ –¥—É—à–µ? –ó–∞–ø–∏—à–∏ —Å–≤–æ–∏ –º—ã—Å–ª–∏, –∏–¥–µ–∏, —Ä–µ—Ñ–ª–µ–∫—Å–∏—é..."></textarea>
                    <button onclick="addDiaryEntry()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </div>

                <div class="diary-entries" id="diary-entries">
                    <!-- –ó–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
            </div>
        </div>

        <!-- –°–µ–≥–æ–¥–Ω—è - –ì–æ–¥–æ–≤–æ–π —Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ -->
        <div id="today-section" class="content-section">
            <div style="padding: 15px;">
                <h2 style="font-size: 1.5em; margin-bottom: 15px; color: #2c3e50; text-align: center;">üìÖ –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ –Ω–∞ 2026 –≥–æ–¥ (1 —è–Ω–≤–∞—Ä—è ‚Äî 31 –¥–µ–∫–∞–±—Ä—è)</h2>
                <div style="margin-bottom: 15px; padding: 10px; background: #f1f5f9; border-radius: 8px; font-size: 0.9em; color: #334155; text-align: center;">
                    –°—Ç–æ–ª–±—Ü—ã: —á–∏—Å–ª–∞, –º–µ—Å—è—Ü—ã, –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –°—Ç—Ä–æ–∫–∏ (–ø—Ä–∏–≤—ã—á–∫–∏) –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.
                </div>
                <div id="year-tracker-wrapper" style="overflow-x: auto; overflow-y: auto; max-height: calc(100vh - 300px); border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); background: white;">
                    <table id="year-tracker-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead id="year-tracker-header">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ JavaScript -->
                        </thead>
                        <tbody id="year-tracker-body">
                            <!-- –°—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–∑–∂–µ -->
                        </tbody>
                        <tfoot>
                            <tr id="year-tracker-total">
                                <td style="padding: 10px; font-weight: 600; background: #f9fafb; border: 1px solid #e5e7eb; text-align: left;">–ò–¢–û–ì–û (–¥–µ–Ω—å)</td>
                                <!-- –°—Ç–æ–ª–±—Ü—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ JavaScript -->
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <footer>
            <div style="text-align: center; color: #666; font-size: 0.9em; padding: 10px;">
                <p>–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞</p>
                <p style="margin-top: 5px; color: #999; font-size: 0.85em;">
                    User ID: <span id="current-user-id">1</span> 
                    | <span id="db-status" style="color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </p>
            </div>
            <button onclick="resetMaslowLevels()" style="margin-left: 20px; padding: 5px 15px; background: #ff6b6b; color: white; border: none; border-radius: 6px; cursor: pointer;">–ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ú–∞—Å–ª–æ—É</button>
        </footer>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        let goals = [
            {
                id: 1,
                title: "–ñ–∏–ª—å—ë",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 2,
                title: "–ü—Ä–æ–¥—É–∫—Ç—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 3,
                title: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (—É—Ö–æ–¥ –∑–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º, –ø—Ä–æ–µ–∑–¥ –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ, —Ç–∞–∫—Å–∏, –∫–∞—Ä—à–µ—Ä–∏–Ω–≥)",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 21,
                title: "–û–¥–µ–∂–¥–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 23,
                title: "–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ñ–∏–Ω. –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 4,
                title: "–®–æ–¥—Ö–∞–Ω - 11—à—Ç",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 16,
                title: "11:11 - –∞–ª—Ñ–∞–≤–∏—Ç",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 17,
                title: "–ì—Ä–∏–±—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 18,
                title: "–ì–≤–æ–∑–¥–∏",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 19,
                title: "–ú–µ–¥–∏—Ç–∞—Ü–∏–∏",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 20,
                title: "–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 5,
                title: "–°–ø–∏–Ω–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 12,
                title: "–í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—Ä–æ–≤–∏ –≤ –Ω–æ—Ä–º–µ",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 13,
                title: "–ó—É–±—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 14,
                title: "–°–æ–Ω",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 6,
                title: "11 –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 4
            },
            {
                id: 15,
                title: "11 –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥–æ–≤",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 4
            },
            {
                id: 7,
                title: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –û–°–¢–†–û–í",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 8,
                title: "–í—ã—É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 24,
                title: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å 11 –∫–Ω–∏–≥",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 25,
                title: "–ò–∑—É—á–∏—Ç—å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 26,
                title: "–ù–∞–π—Ç–∏ –∑–æ–ª–æ—Ç–æ–π –∫–ª—é—á–∏–∫",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–ö–ù–ò–ì–ò –ü–†–û –°–ê–ú–û–°–ê–ë–û–¢–ê–ñ:\n\n–ö–ª–∞—Å—Å–∏–∫–∞:\n1. –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–∞–º - –†–æ–±–µ—Ä—Ç –ö–µ–≥–∞–Ω, –õ–∞–π–∑–∞ –õ–µ–π—Ö–∏\n2. –ü–æ–±–µ–¥–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é! - –ü–µ—Ç—Ä –õ—é–¥–≤–∏–≥\n3. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—Ä–∞–≥ - –°—Ç–∏–≤–µ–Ω –ü—Ä–µ—Å—Å—Ñ–∏–ª–¥\n\n–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è:\n4. –ü–æ—á–µ–º—É –º—ã —Å–∞–±–æ—Ç–∏—Ä—É–µ–º —Å–µ–±—è? - –ú–∞—Ä–≥–∞—Ä–µ—Ç –ü–æ–ª\n5. –¢–µ—Ä–∞–ø–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ - –î–∂–æ–Ω –ë—Ä—ç–¥—à–æ—É\n6. –î—Ä–∞–º–∞ –æ–¥–∞—Ä—ë–Ω–Ω–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞ - –ê–ª–∏—Å –ú–∏–ª–ª–µ—Ä\n\n–î–µ–π—Å—Ç–≤–∏–µ:\n7. –ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ - –î–∂–µ–π–º—Å –ö–ª–∏—Ä\n8. –ù–∞—á–Ω–∏ - –î–∂–æ–Ω –≠–π–∫–∞—Ñ—Ñ\n9. –ü–æ—Ç–æ–∫ - –ú–∏—Ö–∞–π –ß–∏–∫—Å–µ–Ω—Ç–º–∏—Ö–∞–π–∏\n\n–§–∏–ª–æ—Å–æ—Ñ–∏—è:\n10. –ë–µ–≥—Å—Ç–≤–æ –æ—Ç —Å–≤–æ–±–æ–¥—ã - –≠—Ä–∏—Ö –§—Ä–æ–º–º\n11. –ß–µ–ª–æ–≤–µ–∫ –≤ –ø–æ–∏—Å–∫–∞—Ö —Å–º—ã—Å–ª–∞ - –í–∏–∫—Ç–æ—Ä –§—Ä–∞–Ω–∫–ª\n12. –ò–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–∞—é—Ç –ª—é–¥–∏ - –≠—Ä–∏–∫ –ë–µ—Ä–Ω\n\n–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ:\n13. –ù–µ—Å–≤—è—Ç—ã–µ —Å–≤—è—Ç—ã–µ - –°–µ—Ç –ì–æ–¥–∏–Ω\n14. –≠—Å—Å–µ–Ω—Ü–∏–∞–ª–∏–∑–º - –ì—Ä–µ–≥ –ú–∞–∫–ö–µ–æ–Ω\n15. –°–∏–ª–∞ –≤–æ–ª–∏ - –ö–µ–ª–ª–∏ –ú–∞–∫–≥–æ–Ω–∏–≥–∞–ª",
                maslowLevel: 5
            },
            {
                id: 9,
                title: "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –º–æ–¥—É–ª—å–Ω—ã—Ö –¥–æ–º–æ–≤ –∏ –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ –Ω–∞ —á–∏—Å—Ç—É—é –ø—Ä–∏–±—ã–ª—å –≤ 1–º–ª–Ω —Ä—É–±",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–≠—Ç–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –û–°–¢–†–û–í",
                maslowLevel: 1,
                hidden: true
            },
            {
                id: 10,
                title: "–ü–æ–¥–Ω—è—Ç—å—Å—è –Ω–∞ –≠–ª—å–±—Ä—É—Å",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 7
            },
            {
                id: 22,
                title: "10 000 –¥—Ä—É–∑–µ–π",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 7
            },
            {
                id: 11,
                title: "–û—Ç–¥—ã—Ö/–ë–∞–ª–∞–Ω—Å (–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã –∏ —Ä–∞–∑–≥–∏–ª—å–¥—è–π—Å—Ç–≤–æ)",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–ß—Ç–æ–±—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–±—ë–Ω–æ–∫ –Ω–µ –≤–∑–±—É–Ω—Ç–æ–≤–∞–ª—Å—è",
                maslowLevel: 6
            }
        ];

        // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –ø–∏—Ä–∞–º–∏–¥—ã –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞
        const defaultGoals = [
            {
                id: 1,
                title: "–ñ–∏–ª—å—ë",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 2,
                title: "–ü—Ä–æ–¥—É–∫—Ç—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 3,
                title: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (—É—Ö–æ–¥ –∑–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º, –ø—Ä–æ–µ–∑–¥ –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ, —Ç–∞–∫—Å–∏, –∫–∞—Ä—à–µ—Ä–∏–Ω–≥)",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 21,
                title: "–û–¥–µ–∂–¥–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 23,
                title: "–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ñ–∏–Ω. –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 1
            },
            {
                id: 4,
                title: "–®–æ–¥—Ö–∞–Ω - 11—à—Ç",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 16,
                title: "11:11 - –∞–ª—Ñ–∞–≤–∏—Ç",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 17,
                title: "–ì—Ä–∏–±—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 18,
                title: "–ì–≤–æ–∑–¥–∏",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 19,
                title: "–ú–µ–¥–∏—Ç–∞—Ü–∏–∏",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 20,
                title: "–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 3
            },
            {
                id: 5,
                title: "–°–ø–∏–Ω–∞",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 12,
                title: "–í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—Ä–æ–≤–∏ –≤ –Ω–æ—Ä–º–µ",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 13,
                title: "–ó—É–±—ã",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 14,
                title: "–°–æ–Ω",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 2
            },
            {
                id: 6,
                title: "11 –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 4
            },
            {
                id: 15,
                title: "11 –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥–æ–≤",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 4
            },
            {
                id: 7,
                title: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –û–°–¢–†–û–í",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 7
            },
            {
                id: 8,
                title: "–í—ã—É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 24,
                title: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å 11 –∫–Ω–∏–≥",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 25,
                title: "–ò–∑—É—á–∏—Ç—å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 5
            },
            {
                id: 26,
                title: "–ù–∞–π—Ç–∏ –∑–æ–ª–æ—Ç–æ–π –∫–ª—é—á–∏–∫",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–ö–ù–ò–ì–ò –ü–†–û –°–ê–ú–û–°–ê–ë–û–¢–ê–ñ:\n\n–ö–ª–∞—Å—Å–∏–∫–∞:\n1. –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–∞–º - –†–æ–±–µ—Ä—Ç –ö–µ–≥–∞–Ω, –õ–∞–π–∑–∞ –õ–µ–π—Ö–∏\n2. –ü–æ–±–µ–¥–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é! - –ü–µ—Ç—Ä –õ—é–¥–≤–∏–≥\n3. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—Ä–∞–≥ - –°—Ç–∏–≤–µ–Ω –ü—Ä–µ—Å—Å—Ñ–∏–ª–¥\n\n–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è:\n4. –ü–æ—á–µ–º—É –º—ã —Å–∞–±–æ—Ç–∏—Ä—É–µ–º —Å–µ–±—è? - –ú–∞—Ä–≥–∞—Ä–µ—Ç –ü–æ–ª\n5. –¢–µ—Ä–∞–ø–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ - –î–∂–æ–Ω –ë—Ä—ç–¥—à–æ—É\n6. –î—Ä–∞–º–∞ –æ–¥–∞—Ä—ë–Ω–Ω–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞ - –ê–ª–∏—Å –ú–∏–ª–ª–µ—Ä\n\n–î–µ–π—Å—Ç–≤–∏–µ:\n7. –ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ - –î–∂–µ–π–º—Å –ö–ª–∏—Ä\n8. –ù–∞—á–Ω–∏ - –î–∂–æ–Ω –≠–π–∫–∞—Ñ—Ñ\n9. –ü–æ—Ç–æ–∫ - –ú–∏—Ö–∞–π –ß–∏–∫—Å–µ–Ω—Ç–º–∏—Ö–∞–π–∏\n\n–§–∏–ª–æ—Å–æ—Ñ–∏—è:\n10. –ë–µ–≥—Å—Ç–≤–æ –æ—Ç —Å–≤–æ–±–æ–¥—ã - –≠—Ä–∏—Ö –§—Ä–æ–º–º\n11. –ß–µ–ª–æ–≤–µ–∫ –≤ –ø–æ–∏—Å–∫–∞—Ö —Å–º—ã—Å–ª–∞ - –í–∏–∫—Ç–æ—Ä –§—Ä–∞–Ω–∫–ª\n12. –ò–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–∞—é—Ç –ª—é–¥–∏ - –≠—Ä–∏–∫ –ë–µ—Ä–Ω\n\n–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ:\n13. –ù–µ—Å–≤—è—Ç—ã–µ —Å–≤—è—Ç—ã–µ - –°–µ—Ç –ì–æ–¥–∏–Ω\n14. –≠—Å—Å–µ–Ω—Ü–∏–∞–ª–∏–∑–º - –ì—Ä–µ–≥ –ú–∞–∫–ö–µ–æ–Ω\n15. –°–∏–ª–∞ –≤–æ–ª–∏ - –ö–µ–ª–ª–∏ –ú–∞–∫–≥–æ–Ω–∏–≥–∞–ª",
                maslowLevel: 5
            },
            {
                id: 9,
                title: "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –º–æ–¥—É–ª—å–Ω—ã—Ö –¥–æ–º–æ–≤ –∏ –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ –Ω–∞ —á–∏—Å—Ç—É—é –ø—Ä–∏–±—ã–ª—å –≤ 1–º–ª–Ω —Ä—É–±",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–≠—Ç–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –û–°–¢–†–û–í",
                maslowLevel: 1,
                hidden: true
            },
            {
                id: 10,
                title: "–ü–æ–¥–Ω—è—Ç—å—Å—è –Ω–∞ –≠–ª—å–±—Ä—É—Å",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 7
            },
            {
                id: 22,
                title: "10 000 –¥—Ä—É–∑–µ–π",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "",
                maslowLevel: 7
            },
            {
                id: 11,
                title: "–û—Ç–¥—ã—Ö/–ë–∞–ª–∞–Ω—Å (–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã –∏ —Ä–∞–∑–≥–∏–ª—å–¥—è–π—Å—Ç–≤–æ)",
                status: "not_started",
                progress: 0,
                criteria: "",
                subtasks: [],
                priority: null,
                notes: "–ß—Ç–æ–±—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–±—ë–Ω–æ–∫ –Ω–µ –≤–∑–±—É–Ω—Ç–æ–≤–∞–ª—Å—è",
                maslowLevel: 6
            }
        ];

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –ë–î
        function renderPyramidLevels() {
            const container = document.getElementById('pyramid-levels-container');
            if (!container) {
                console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä pyramid-levels-container –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            container.innerHTML = '';
            
            console.log('üì¶ pyramidLevelsCache:', pyramidLevelsCache);
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∏–∑ –∫—ç—à–∞, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ id
            const levels = Object.keys(pyramidLevelsCache)
                .map(id => ({ 
                    id: parseInt(id), 
                    name: pyramidLevelsCache[id].name,
                    color: pyramidLevelsCache[id].color
                }))
                .sort((a, b) => a.id - b.id);
            
            console.log('üìã –†–∞–∑–¥–µ–ª—ã –∏–∑ –∫—ç—à–∞:', levels);
            
            // –ï—Å–ª–∏ –∫—ç—à –ø—É—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
            if (levels.length === 0) {
                console.warn('‚ö†Ô∏è –ö—ç—à —Ä–∞–∑–¥–µ–ª–æ–≤ –ø—É—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');
                levels.push(
                    { id: 1, name: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å', color: '#c0392b' },
                    { id: 2, name: '–ó–¥–æ—Ä–æ–≤—å–µ', color: '#d35400' },
                    { id: 3, name: '–î—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏', color: '#d68910' },
                    { id: 4, name: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', color: '#229954' },
                    { id: 5, name: '–û–±—É—á–µ–Ω–∏–µ', color: '#7d3c98' },
                    { id: 6, name: '–û—Ç–¥—ã—Ö/–ë–∞–ª–∞–Ω—Å', color: '#c0392b' },
                    { id: 7, name: '–ü—Ä–æ–µ–∫—Ç—ã –∏ –≤–µ—Ä—à–∏–Ω—ã', color: '#138d75' }
                );
            }
            
            // –°–æ–∑–¥–∞—ë–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ CSS —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ (–±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã)
            let dynamicStyles = '';
            levels.forEach(level => {
                const baseColor = level.color || '#667eea';
                const rgb = hexToRgb(baseColor);
                const lighterRgb = lightenColor(rgb, 20);
                const gradientColor = `linear-gradient(135deg, ${rgbToHex(lighterRgb)} 0%, ${baseColor} 100%)`;
                const textColor = getContrastColor(baseColor);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: inline styles > #id .class > .class
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º background (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ) –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                dynamicStyles += `#pyramid-levels-container .pyramid-level.level-${level.id},
                .maslow-pyramid #pyramid-levels-container .pyramid-level.level-${level.id},
                .maslow-pyramid .pyramid-level.level-${level.id},
                .pyramid-level.level-${level.id} {
                    background: ${gradientColor} !important;
                    color: ${textColor} !important;
                }\n`;
            });
            
            // –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º style —ç–ª–µ–º–µ–Ω—Ç (–≤—Å—Ç–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü head –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            let styleEl = document.getElementById('dynamic-pyramid-styles');
            if (styleEl) {
                styleEl.remove();
            }
            styleEl = document.createElement('style');
            styleEl.id = 'dynamic-pyramid-styles';
            styleEl.textContent = dynamicStyles;
            document.head.appendChild(styleEl);
            
            // console.log('üé® –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:', dynamicStyles.substring(0, 200) + '...');
            
            // –°–æ–∑–¥–∞—ë–º HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
            levels.forEach(level => {
                const levelDiv = document.createElement('div');
                levelDiv.className = `pyramid-level level-${level.id}`;
                
                const baseColor = level.color || '#667eea';
                const rgb = hexToRgb(baseColor);
                const lighterRgb = lightenColor(rgb, 20);
                const gradientColor = `linear-gradient(135deg, ${rgbToHex(lighterRgb)} 0%, ${baseColor} 100%)`;
                const textColor = getContrastColor(baseColor);
                
                levelDiv.innerHTML = `
                    <div class="level-title">${level.id}. ${level.name}</div>
                    <div class="level-goals" id="goals-${level.id}"></div>
                `;
                
                container.appendChild(levelDiv);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –ü–û–°–õ–ï –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
                levelDiv.style.backgroundImage = gradientColor;
                levelDiv.style.backgroundColor = 'transparent';
                levelDiv.style.color = textColor;
            });
            
            // console.log(`‚úÖ –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ ${levels.length} —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã`);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        async function loadData() {
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã –ø–∏—Ä–∞–º–∏–¥—ã –∏–∑ –ë–î
            await loadPyramidLevels();
            
            // –°–æ–∑–¥–∞—ë–º —Ä–∞–∑–¥–µ–ª—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            renderPyramidLevels();
            
            // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ü–µ–ª–∏ –∏–∑ –ë–î
            const dbGoals = await loadGoalsFromDB();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            updatePyramidDBStatus(dbGoals !== null);
            
            if (dbGoals !== null && dbGoals.length > 0) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
                goals = dbGoals;
                console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –ë–î:', goals.length, '—Ü–µ–ª–µ–π');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–≥–∏ –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π
                await loadAllSteps();
                console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —à–∞–≥–∏ –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π');
            } else if (dbGoals === null) {
                // –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É.');
                goals = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
            } else {
                // –ë–î –ø—É—Å—Ç–∞ - —Å–æ–∑–¥–∞—ë–º —Ü–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                console.log('üìù –ë–î –ø—É—Å—Ç–∞, —Å–æ–∑–¥–∞—é —Ü–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é...');
                goals = JSON.parse(JSON.stringify(defaultGoals));
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Ü–µ–ª–∏ –≤ –ë–î
                for (const goal of goals) {
                    await saveGoalToDB(goal);
                }
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
                const savedGoals = await loadGoalsFromDB();
                if (savedGoals !== null && savedGoals.length > 0) {
                    goals = savedGoals;
                    console.log('‚úÖ –¶–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î:', goals.length, '—Ü–µ–ª–µ–π');
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
        async function saveData() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
            let savedToDB = 0;
            let failedToDB = 0;
            
            for (const goal of goals) {
                if (goal.hidden) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ —Ü–µ–ª–∏
                
                try {
                    const saved = await saveGoalToDB(goal);
                    if (saved) {
                        savedToDB++;
            } else {
                        failedToDB++;
                        console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å "${goal.title}" –≤ –ë–î`);
                    }
                } catch (error) {
                    console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–ª–∏ "${goal.title}":`, error);
                    failedToDB++;
                }
            }
            
            if (savedToDB > 0) {
                console.log(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: ${savedToDB} —Ü–µ–ª–µ–π`);
            }
            if (failedToDB > 0) {
                console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î: ${failedToDB} —Ü–µ–ª–µ–π`);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            updateTotalProgress();
        }


        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(viewName + '-view').classList.add('active');
            event.target.classList.add('active');
            
            if (viewName === 'list') renderListView();
            else if (viewName === 'cards') renderCardsView();
            else if (viewName === 'table') renderTableView();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateTotalProgress() {
            const totalProgress = goals.reduce((sum, goal) => {
                return sum + calculateGoalProgress(goal);
            }, 0) / goals.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const header = document.getElementById('mainHeader');
            if (header) {
                header.style.setProperty('--progress', totalProgress + '%');
                header.style.background = `
                    linear-gradient(135deg, 
                        #6bcf7f 0%, 
                        #4ecdc4 ${totalProgress}%, 
                        #667eea ${totalProgress}%, 
                        #764ba2 100%
                    )
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã –∏–∑ –ë–î
        async function loadPyramidLevels() {
            try {
                const userId = getUserId();
                
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∫–∞–∫–∏–µ level_id –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
                const goalsUrl = `${API_BASE_URL}/2026_goal?where.user_id=${userId}&order=level_id:asc`;
                const goalsResponse = await fetch(goalsUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (!goalsResponse.ok) {
                    throw new Error(`HTTP ${goalsResponse.status}: ${goalsResponse.statusText}`);
                }
                
                const goalsData = await goalsResponse.json();
                const usedLevelIds = new Set();
                
                if (goalsData.rows && Array.isArray(goalsData.rows)) {
                    goalsData.rows.forEach(goal => {
                        if (goal.level_id) {
                            usedLevelIds.add(goal.level_id);
                        }
                    });
                }
                
                console.log('üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ level_id:', Array.from(usedLevelIds));
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ü–µ–ª–µ–π, –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
                if (usedLevelIds.size === 0) {
                    console.warn('‚ö†Ô∏è –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Ü–µ–ª–µ–π, –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
                const url = `${API_BASE_URL}/2026_levels?order=id:asc`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.rows && Array.isArray(data.rows)) {
                    // –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç: level_id -> {name, color}
                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Ä–∞–∑–¥–µ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ü–µ–ª—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    pyramidLevelsCache = {};
                    data.rows.forEach(level => {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ü–µ–ª–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–∞–∑–¥–µ–ª—ã
                        // –ï—Å–ª–∏ —Ü–µ–ª–µ–π –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ
                        if (usedLevelIds.size === 0 || usedLevelIds.has(level.id)) {
                            pyramidLevelsCache[level.id] = {
                                name: level.level_name,
                                color: level.color || '#667eea' // Fallback —Ü–≤–µ—Ç
                            };
                        }
                    });
                    console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã:', Object.keys(pyramidLevelsCache).length);
                    console.log('üì¶ –†–∞–∑–¥–µ–ª—ã:', pyramidLevelsCache);
                    return pyramidLevelsCache;
                } else {
                    console.warn('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API –¥–ª—è 2026_levels:', data);
                    return {};
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã –∏–∑ –ë–î:', error);
                // Fallback –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                pyramidLevelsCache = {
                    1: { name: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å', color: '#e74c3c' },
                    2: { name: '–ó–¥–æ—Ä–æ–≤—å–µ', color: '#e67e22' },
                    3: { name: '–î—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏', color: '#f39c12' },
                    4: { name: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', color: '#27ae60' },
                    5: { name: '–û–±—É—á–µ–Ω–∏–µ', color: '#9b59b6' },
                    6: { name: '–û—Ç–¥—ã—Ö/–ë–∞–ª–∞–Ω—Å', color: '#e91e63' },
                    7: { name: '–ü—Ä–æ–µ–∫—Ç—ã –∏ –≤–µ—Ä—à–∏–Ω—ã', color: '#16a085' }
                };
                return pyramidLevelsCache;
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–∞–º–∏
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 102, g: 126, b: 234 }; // Fallback
        }
        
        function rgbToHex(rgb) {
            // –í–ê–ñ–ù–û: r/g/b –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä–æ–±–Ω—ã–º–∏ (–ø–æ—Å–ª–µ lightenColor/darkenColor).
            // –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥—Ä–æ–±—å, Number.toString(16) –≤–µ—Ä–Ω—ë—Ç —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ "dea03f.ccccccd",
            // —á—Ç–æ –ª–æ–º–∞–µ—Ç CSS —Ü–≤–µ—Ç–∞ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã.
            const clampByte = (v) => Math.max(0, Math.min(255, Math.round(Number(v) || 0)));
            const r = clampByte(rgb?.r);
            const g = clampByte(rgb?.g);
            const b = clampByte(rgb?.b);
            return '#' + [r, g, b].map(v => v.toString(16).padStart(2, '0')).join('');
        }
        
        function lightenColor(rgb, percent) {
            return {
                r: Math.min(255, rgb.r + (255 - rgb.r) * percent / 100),
                g: Math.min(255, rgb.g + (255 - rgb.g) * percent / 100),
                b: Math.min(255, rgb.b + (255 - rgb.b) * percent / 100)
            };
        }
        
        function darkenColor(rgb, percent) {
            return {
                r: Math.max(0, rgb.r * (1 - percent / 100)),
                g: Math.max(0, rgb.g * (1 - percent / 100)),
                b: Math.max(0, rgb.b * (1 - percent / 100))
            };
        }
        
        function getContrastColor(hex) {
            const rgb = hexToRgb(hex);
            // –í—ã—á–∏—Å–ª—è–µ–º —è—Ä–∫–æ—Å—Ç—å –ø–æ —Ñ–æ—Ä–º—É–ª–µ YIQ
            const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
            return brightness > 128 ? '#2c3e50' : '#ffffff';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è –ø–∏—Ä–∞–º–∏–¥—ã (–∏–∑ –ë–î –∏–ª–∏ –∫—ç—à–∞)
        function getMaslowLevelName(levelId) {
            // levelId –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º (level_id –∏–∑ –ë–î) –∏–ª–∏ maslowLevel (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
            const level = typeof levelId === 'number' ? levelId : levelId;
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –∏–∑ –ë–î
            if (pyramidLevelsCache[level] && pyramidLevelsCache[level].name) {
                return pyramidLevelsCache[level].name;
            }
            
            // Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
            const fallbackNames = {
                1: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å',
                2: '–ó–¥–æ—Ä–æ–≤—å–µ',
                3: '–î—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏',
                4: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è',
                5: '–û–±—É—á–µ–Ω–∏–µ',
                6: '–û—Ç–¥—ã—Ö/–ë–∞–ª–∞–Ω—Å',
                7: '–ü—Ä–æ–µ–∫—Ç—ã –∏ –≤–µ—Ä—à–∏–Ω—ã'
            };
            
            return fallbackNames[level] || `–†–∞–∑–¥–µ–ª ${level}`;
        }

        // –†–∞—Å—á—ë—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ü–µ–ª–∏
        function calculateGoalProgress(goal) {
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —à–∞–≥–∏ –∏–∑ –ë–î > –ø–æ–¥–∑–∞–¥–∞—á–∏ > –ø—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏
            const steps = goalStepsCache[goal.id] || [];
            if (steps.length > 0) {
                const completedSteps = steps.filter(s => s.status === 'completed').length;
                const totalSteps = steps.filter(s => s.status !== 'cancelled').length;
                if (totalSteps > 0) {
                    return Math.round((completedSteps / totalSteps) * 100);
                }
            }
            
            // Fallback –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
            if (goal.subtasks && goal.subtasks.length > 0) {
                const completed = goal.subtasks.filter(st => st.completed).length;
                return Math.round((completed / goal.subtasks.length) * 100);
            }
            
            // Fallback –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏
            return goal.progress || 0;
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è: –°–ø–∏—Å–æ–∫
        function renderListView(filterLevel = null) {
            const container = document.getElementById('goals-list');
            container.innerHTML = '';
            
            const filteredGoals = filterLevel ? goals.filter(g => g.maslowLevel === filterLevel) : goals;
            
            filteredGoals.forEach(goal => {
                const goalDiv = document.createElement('div');
                goalDiv.className = `goal-item maslow-${goal.maslowLevel || 1}`;
                goalDiv.dataset.goalId = goal.id;
                
                const progress = calculateGoalProgress(goal);
                const hasSubtasks = goal.subtasks && goal.subtasks.length > 0;
                const maslowLevel = goal.maslowLevel || 1;
                
                goalDiv.innerHTML = `
                    <div class="goal-header">
                        <input type="checkbox" class="goal-checkbox" ${goal.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleGoalStatus(${goal.id})">
                        ${hasSubtasks ? `<button class="expand-btn" onclick="toggleExpand(${goal.id})">‚ñº</button>` : ''}
                        <div class="goal-title">${goal.title}</div>
                        <span class="maslow-badge maslow-${maslowLevel}">${maslowLevel}. ${getMaslowLevelName(maslowLevel)}</span>
                    </div>
                    <div class="goal-progress-bar">
                        <div class="goal-progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <div class="goal-progress-text">${progress}%</div>
                    ${hasSubtasks ? `
                        <div class="goal-subtasks" id="subtasks-${goal.id}">
                            ${goal.subtasks.map(st => `
                                <div class="subtask-item">
                                    <input type="checkbox" class="subtask-checkbox" ${st.completed ? 'checked' : ''}
                                           onchange="toggleSubtask(${goal.id}, ${st.id})">
                                    <span>${st.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(goalDiv);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è: –ö–∞—Ä—Ç–æ—á–∫–∏
        function renderCardsView(filterLevel = null) {
            const container = document.getElementById('goals-cards');
            container.innerHTML = '';
            
            const filteredGoals = filterLevel ? goals.filter(g => g.maslowLevel === filterLevel) : goals;
            
            filteredGoals.forEach(goal => {
                const card = document.createElement('div');
                const maslowLevel = goal.maslowLevel || 1;
                card.className = `goal-card maslow-${maslowLevel}`;
                card.dataset.goalId = goal.id;
                
                const progress = calculateGoalProgress(goal);
                
                card.innerHTML = `
                    <div class="card-title">
                        ${goal.title}
                        <span class="maslow-badge maslow-${maslowLevel}">${maslowLevel}. ${getMaslowLevelName(maslowLevel)}</span>
                    </div>
                    
                    <div class="card-section">
                        <label>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</label>
                        <textarea onchange="updateGoalField(${goal.id}, 'criteria', this.value)" 
                                  placeholder="–û–ø–∏—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞...">${goal.criteria}</textarea>
                    </div>
                    
                    <div class="card-section">
                        <label>–ü–æ–¥–∑–∞–¥–∞—á–∏:</label>
                        <ul class="subtasks-list" id="card-subtasks-${goal.id}">
                            ${goal.subtasks.map(st => `
                                <li>
                                    <input type="checkbox" class="subtask-checkbox" ${st.completed ? 'checked' : ''}
                                           onchange="toggleSubtask(${goal.id}, ${st.id})">
                                    <span>${st.text}</span>
                                </li>
                            `).join('')}
                        </ul>
                        <button class="add-subtask" onclick="addSubtask(${goal.id})">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É</button>
                    </div>
                    
                    <div class="card-section">
                        <label>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}%</label>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è: –¢–∞–±–ª–∏—Ü–∞
        function renderTableView(filterLevel = null) {
            const tbody = document.getElementById('goals-table-body');
            tbody.innerHTML = '';
            
            const filteredGoals = filterLevel ? goals.filter(g => g.maslowLevel === filterLevel) : goals;
            
            filteredGoals.forEach(goal => {
                const row = document.createElement('tr');
                const progress = calculateGoalProgress(goal);
                const maslowLevel = goal.maslowLevel || 1;
                
                row.innerHTML = `
                    <td class="editable" contenteditable="true" onblur="updateGoalField(${goal.id}, 'title', this.textContent)">${goal.title}</td>
                    <td>
                        <select class="status-badge status-${goal.status}" onchange="updateGoalField(${goal.id}, 'status', this.value); this.className='status-badge status-' + this.value">
                            <option value="not_started" ${goal.status === 'not_started' ? 'selected' : ''}>–ù–µ –Ω–∞—á–∞—Ç–æ</option>
                            <option value="in_progress" ${goal.status === 'in_progress' ? 'selected' : ''}>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
                            <option value="completed" ${goal.status === 'completed' ? 'selected' : ''}>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                        </select>
                    </td>
                    <td>
                        <div class="table-progress-bar">
                            <div class="table-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        ${progress}%
                    </td>
                    <td>
                        <span class="maslow-badge maslow-${maslowLevel}">${maslowLevel}. ${getMaslowLevelName(maslowLevel)}</span>
                    </td>
                    <td class="editable" contenteditable="true" onblur="updateGoalField(${goal.id}, 'notes', this.textContent)">${goal.notes || ''}</td>
                    <td>
                        <select class="priority-select" onchange="updateGoalField(${goal.id}, 'priority', this.value)">
                            <option value="">-</option>
                            <option value="1" ${goal.priority === '1' ? 'selected' : ''}>1 - –í—ã—Å–æ–∫–∏–π</option>
                            <option value="2" ${goal.priority === '2' ? 'selected' : ''}>2</option>
                            <option value="3" ${goal.priority === '3' ? 'selected' : ''}>3</option>
                            <option value="4" ${goal.priority === '4' ? 'selected' : ''}>4</option>
                            <option value="5" ${goal.priority === '5' ? 'selected' : ''}>5 - –ù–∏–∑–∫–∏–π</option>
                        </select>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è —Ü–µ–ª–∏
        async function updateGoalField(goalId, field, value) {
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                goal[field] = value;
                
                // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                if (field === 'status') {
                    if (value === 'completed') {
                        goal.progress = 100;
                        if (goal.subtasks) {
                            goal.subtasks.forEach(st => st.completed = true);
                        }
                    } else if (value === 'not_started') {
                        goal.progress = 0;
                        if (goal.subtasks) {
                            goal.subtasks.forEach(st => st.completed = false);
                        }
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å—Ä–∞–∑—É
                await saveGoalToDB(goal);
                // Backup –≤ localStorage
                await saveData();
                
                renderMaslowPyramid();
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                const activeView = document.querySelector('.view.active');
                if (activeView.id === 'list-view') renderListView(currentFilterLevel);
                else if (activeView.id === 'cards-view') renderCardsView(currentFilterLevel);
                else if (activeView.id === 'table-view') renderTableView(currentFilterLevel);
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ü–µ–ª–∏
        async function toggleGoalStatus(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                if (goal.status === 'completed') {
                    goal.status = 'not_started';
                    goal.progress = 0;
                    if (goal.subtasks) {
                        goal.subtasks.forEach(st => st.completed = false);
                    }
                } else {
                    goal.status = 'completed';
                    goal.progress = 100;
                    if (goal.subtasks) {
                        goal.subtasks.forEach(st => st.completed = true);
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å—Ä–∞–∑—É
                await saveGoalToDB(goal);
                // Backup –≤ localStorage
                await saveData();
                
                renderMaslowPyramid();
                renderListView(currentFilterLevel);
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏
        async function toggleSubtask(goalId, subtaskId) {
            const goal = goals.find(g => g.id === goalId);
            if (goal && goal.subtasks) {
                const subtask = goal.subtasks.find(st => st.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    goal.progress = calculateGoalProgress(goal);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ü–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    if (goal.progress === 100) {
                        goal.status = 'completed';
                    } else if (goal.progress > 0) {
                        goal.status = 'in_progress';
                    } else {
                        goal.status = 'not_started';
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å—Ä–∞–∑—É
                    await saveGoalToDB(goal);
                    // Backup –≤ localStorage
                    await saveData();
                    
                    renderMaslowPyramid();
                    
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                    const activeView = document.querySelector('.view.active');
                    if (activeView.id === 'list-view') renderListView(currentFilterLevel);
                    else if (activeView.id === 'cards-view') renderCardsView(currentFilterLevel);
                    else if (activeView.id === 'table-view') renderTableView(currentFilterLevel);
                }
            }
        }

        // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á
        function toggleExpand(goalId) {
            const goalItem = document.querySelector(`[data-goal-id="${goalId}"]`);
            const subtasks = document.getElementById(`subtasks-${goalId}`);
            const btn = goalItem.querySelector('.expand-btn');
            
            if (goalItem.classList.contains('expanded')) {
                goalItem.classList.remove('expanded');
                btn.textContent = '‚ñº';
            } else {
                goalItem.classList.add('expanded');
                btn.textContent = '‚ñ≤';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏
        async function addSubtask(goalId) {
            const text = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ–¥–∑–∞–¥–∞—á–∏:');
            if (text && text.trim()) {
                const goal = goals.find(g => g.id === goalId);
                if (goal) {
                    if (!goal.subtasks) goal.subtasks = [];
                    const newId = goal.subtasks.length > 0 
                        ? Math.max(...goal.subtasks.map(st => st.id)) + 1 
                        : 1;
                    goal.subtasks.push({ id: newId, text: text.trim(), completed: false });
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å—Ä–∞–∑—É
                    await saveGoalToDB(goal);
                    // Backup –≤ localStorage
                    await saveData();
                    
                    renderMaslowPyramid();
                    renderCardsView(currentFilterLevel);
                }
            }
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        let sortDirection = {};
        function sortTable(column) {
            const dir = sortDirection[column] === 'asc' ? 'desc' : 'asc';
            sortDirection[column] = dir;
            
            goals.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (column === 'progress') {
                    aVal = calculateGoalProgress(a);
                    bVal = calculateGoalProgress(b);
                }
                
                if (typeof aVal === 'string') {
                    return dir === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                } else {
                    return dir === 'asc' ? aVal - bVal : bVal - aVal;
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            renderMaslowPyramid();
            renderTableView(currentFilterLevel);
        }

        // –†–µ–Ω–¥–µ—Ä –ø–∏—Ä–∞–º–∏–¥—ã –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞
        function renderMaslowPyramid() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ level_id –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤, –∏–ª–∏ –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ level_id –∏–∑ —Ü–µ–ª–µ–π
            let levels;
            if (Object.keys(pyramidLevelsCache).length > 0) {
                levels = Object.keys(pyramidLevelsCache).map(id => parseInt(id)).sort((a, b) => a - b);
            } else {
                // –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ level_id –∏–∑ —Ü–µ–ª–µ–π
                const uniqueLevels = [...new Set(goals.map(g => g.maslowLevel || g.level_id || 1))];
                levels = uniqueLevels.sort((a, b) => a - b);
            }
            
            // –í–ê–ñ–ù–û: —Å—á–∏—Ç–∞–µ–º —Å—É–º–º—É –ø–æ –í–°–ï–ú —Ü–µ–ª—è–º, –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º —É—Ä–æ–≤–Ω—è–º
            let totalCost = 0;
            goals.forEach(goal => {
                if (!goal.hidden) {
                    const total = (goal.total !== null && goal.total !== undefined) ? parseFloat(goal.total) : ((goal.price || 0) * (goal.quantity || 1));
                    totalCost += total;
                }
            });
            
            levels.forEach(level => {
                const levelGoals = goals.filter(g => (g.maslowLevel || g.level_id || 1) === level && !g.hidden);
                const goalsEl = document.getElementById(`goals-${level}`);
                
                if (goalsEl) {
                    if (levelGoals.length === 0) {
                        goalsEl.innerHTML = '';
                    } else {
                        const header = `
                            <div class="level-goals-header">
                                <span>–¶–µ–ª—å</span>
                                <span>–¶–µ–Ω–∞</span>
                                <span>–ö–æ–ª-–≤–æ</span>
                                <span>–°—É–º–º–∞</span>
                                <span style="text-align: right;">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                <span></span>
                            </div>
                        `;
                        
                        const goalsHtml = levelGoals.map(goal => {
                            const progress = calculateGoalProgress(goal);
                            const price = goal.price || 0;
                            const quantity = goal.quantity || 1;
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º total –∏–∑ –ë–î (—É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ), –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º
                            const total = (goal.total !== null && goal.total !== undefined) ? parseFloat(goal.total) : (price * quantity);
                            // totalCost —É–∂–µ –ø–æ—Å—á–∏—Ç–∞–Ω –≤—ã—à–µ –ø–æ –≤—Å–µ–º —Ü–µ–ª—è–º, –Ω–µ —Å—á–∏—Ç–∞–µ–º –∑–¥–µ—Å—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
                            
                            // –ü–æ–ª—É—á–∞–µ–º —à–∞–≥–∏ –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏
                            const steps = goalStepsCache[goal.id] || [];
                            const completedSteps = steps.filter(s => s.status === 'completed').length;
                            const totalSteps = steps.filter(s => s.status !== 'cancelled').length;
                            
                            // –†–µ–Ω–¥–µ—Ä–∏–º —à–∞–≥–∏
                            let stepsHtml = '';
                            if (steps.length > 0) {
                                stepsHtml = `
                                    <div class="goal-steps-container">
                                        <div class="goal-steps-header">
                                            <span>–®–∞–≥–∏ (${completedSteps}/${totalSteps})</span>
                                        </div>
                                        <div class="goal-steps-list">
                                            ${steps.map(step => {
                                                const stepIcon = step.step_type === 'book' ? 'üìñ' : 
                                                                 step.step_type === 'film' ? 'üé¨' : 
                                                                 step.step_type === 'course' ? 'üìö' : '‚úì';
                                                const isCompleted = step.status === 'completed';
                                                const isInProgress = step.status === 'in_progress';
                                                const progressText = step.progress !== null ? ` (${step.progress}%)` : '';
                                                
                            return `
                                                    <div class="goal-step-item ${isCompleted ? 'completed' : ''} ${isInProgress ? 'in-progress' : ''}" 
                                                         data-step-id="${step.id}">
                                                        <input type="checkbox" 
                                                               ${isCompleted ? 'checked' : ''}
                                                               onchange="toggleStepStatus(${step.id}, this.checked, ${goal.id})"
                                                               class="step-checkbox">
                                                        <span class="step-icon">${stepIcon}</span>
                                                        <span class="step-name">${step.step_name}</span>
                                                        ${progressText ? `<span class="step-progress">${progressText}</span>` : ''}
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `;
                            }
                            
                            const hasSteps = steps.length > 0;
                            const stepsToggleId = `steps-toggle-${goal.id}`;
                            
                            return `
                                <div class="level-goal-item" data-goal-id="${goal.id}">
                                    <div class="level-goal-main-row">
                                        <span class="level-goal-title">${goal.title}</span>
                                        <div class="level-goal-price">
                                            <input type="number" value="${price}" 
                                                   onchange="updateGoalPrice(${goal.id}, parseFloat(this.value) || 0)"
                                                   placeholder="0" step="0.01" min="0">
                                        </div>
                                        <div class="level-goal-quantity">
                                            <input type="number" value="${quantity}" 
                                                   onchange="updateGoalQuantity(${goal.id}, parseInt(this.value) || 1)"
                                                   placeholder="1" step="1" min="1">
                                        </div>
                                        <span class="level-goal-total">${total.toLocaleString('ru-RU')} ‚ÇΩ</span>
                                        <span class="level-goal-progress">${progress}%</span>
                                        ${hasSteps ? `<button class="steps-toggle-btn" onclick="toggleGoalSteps(${goal.id})" aria-expanded="false">
                                            <span class="steps-toggle-icon">‚ñº</span>
                                            <span class="steps-toggle-text">–®–∞–≥–∏ (${completedSteps}/${totalSteps})</span>
                                        </button>` : ''}
                                    </div>
                                    ${hasSteps ? `<div class="goal-steps-accordion" id="${stepsToggleId}" style="display: none;">
                                        ${stepsHtml}
                                    </div>` : ''}
                                </div>
                            `;
                        }).join('');
                        
                        goalsEl.innerHTML = header + goalsHtml;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
            const totalCostEl = document.getElementById('totalCost');
            if (totalCostEl) {
                totalCostEl.textContent = totalCost.toLocaleString('ru-RU') + ' ‚ÇΩ';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–æ—Ö–æ–¥ (–æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å / 11)
            const requiredIncome = totalCost / 11;
            const requiredIncomeEl = document.getElementById('requiredIncome');
            if (requiredIncomeEl) {
                requiredIncomeEl.textContent = requiredIncome.toLocaleString('ru-RU', {maximumFractionDigits: 0}) + ' ‚ÇΩ';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
            updateTotalProgress();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ü–µ–ª–∏
        async function updateGoalPrice(goalId, price) {
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                goal.price = price;
                await saveGoalToDB(goal); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–∑—É –≤ –ë–î
                await saveData(); // –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                renderMaslowPyramid();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–µ–ª–∏
        async function updateGoalQuantity(goalId, quantity) {
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                goal.quantity = quantity;
                await saveGoalToDB(goal); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–∑—É –≤ –ë–î
                await saveData(); // –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                renderMaslowPyramid();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —É—Ä–æ–≤–Ω—è –≤ –ø–∏—Ä–∞–º–∏–¥–µ (–æ—Ç–∫–ª—é—á–µ–Ω–æ - –≤—Å–µ–≥–¥–∞ —Ä–∞—Å–∫—Ä—ã—Ç–æ)
        function toggleLevel(level) {
            // –£—Ä–æ–≤–Ω–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞—Å–∫—Ä—ã—Ç—ã, —Ñ—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            const levelEl = document.querySelector(`.pyramid-level.level-${level}`);
            if (levelEl) {
                levelEl.classList.add('expanded');
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –ú–∞—Å–ª–æ—É
        let currentFilterLevel = null;
        function filterByMaslow(level) {
            currentFilterLevel = level;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
            const activeView = document.querySelector('.view.active');
            if (activeView.id === 'list-view') renderListView(level);
            else if (activeView.id === 'cards-view') renderCardsView(level);
            else if (activeView.id === 'table-view') renderTableView(level);
        }

        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ü–µ–ª–∏
        function scrollToGoal(goalId) {
            const goalEl = document.querySelector(`[data-goal-id="${goalId}"]`);
            if (goalEl) {
                goalEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                goalEl.style.animation = 'pulse 0.5s';
                setTimeout(() => goalEl.style.animation = '', 500);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ switchView –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const originalSwitchView = switchView;
        switchView = function(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(viewName + '-view').classList.add('active');
            event.target.classList.add('active');
            
            if (viewName === 'list') renderListView(currentFilterLevel);
            else if (viewName === 'cards') renderCardsView(currentFilterLevel);
            else if (viewName === 'table') renderTableView(currentFilterLevel);
        };

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –ú–∞—Å–ª–æ—É
        async function resetMaslowLevels() {
            if (confirm('–ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ø–∏—Ä–∞–º–∏–¥—ã –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π? –≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.')) {
                for (const goal of goals) {
                    const defaultGoal = defaultGoals.find(dg => dg.id === goal.id);
                    if (defaultGoal) {
                        goal.maslowLevel = defaultGoal.maslowLevel;
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—É—é —Ü–µ–ª—å –≤ –ë–î
                        await saveGoalToDB(goal);
                    }
                }
                await saveData(); // Backup –≤ localStorage
                renderMaslowPyramid();
                const activeView = document.querySelector('.view.active');
                if (activeView.id === 'list-view') renderListView(currentFilterLevel);
                else if (activeView.id === 'cards-view') renderCardsView(currentFilterLevel);
                else if (activeView.id === 'table-view') renderTableView(currentFilterLevel);
                alert('–£—Ä–æ–≤–Ω–∏ –ø–∏—Ä–∞–º–∏–¥—ã –ë–∞—Ä–∞–±–∞–Ω–æ–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!\n\n–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å:\n\n1. –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –ñ–∏–ª—å—ë, –ü—Ä–æ–¥—É–∫—Ç—ã, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –¥–æ–º–æ–≤\n2. –ó–¥–æ—Ä–æ–≤—å–µ: –°–ø–∏–Ω–∞, –í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—Ä–æ–≤–∏ –≤ –Ω–æ—Ä–º–µ, –ó—É–±—ã, –°–æ–Ω\n3. –î—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏: –®–æ–¥—Ö–∞–Ω - 11—à—Ç, 11:11 - –∞–ª—Ñ–∞–≤–∏—Ç, –ì—Ä–∏–±—ã, –ì–≤–æ–∑–¥–∏, –ú–µ–¥–∏—Ç–∞—Ü–∏–∏, –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ\n4. –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: 11 –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, 11 –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥–æ–≤\n5. –ü—Ä–æ–µ–∫—Ç—ã –∏ –≤–µ—Ä—à–∏–Ω—ã: –û–°–¢–†–û–í, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –≠–ª—å–±—Ä—É—Å');
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
            document.querySelectorAll('.header-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                section.classList.add('active');
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é —Å—Å—ã–ª–∫—É
            const navLink = document.getElementById('nav-' + sectionName);
            if (navLink) {
                navLink.classList.add('active');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–∑ localStorage
        function loadSchedule() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è - –µ—Å–ª–∏ —Å—Ç–∞—Ä–∞—è, –æ—á–∏—â–∞–µ–º
            const scheduleVersion = localStorage.getItem('makc_2026_schedule_version');
            if (scheduleVersion !== '3') {
                localStorage.removeItem('makc_2026_schedule');
                localStorage.setItem('makc_2026_schedule_version', '3');
                return; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ HTML
            }
            
            const saved = localStorage.getItem('makc_2026_schedule');
            if (saved) {
                try {
                    const schedule = JSON.parse(saved);
                    Object.keys(schedule).forEach(key => {
                        const cell = document.querySelector(`[data-day="${schedule[key].day}"][data-time="${schedule[key].time}"]`);
                        if (cell) {
                            // –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —è—á–µ–π–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å div'–∞–º–∏
                            const hasStructure = cell.querySelector('.schedule-main-action, .schedule-sub-action');
                            if (!hasStructure && schedule[key].text) {
                                // –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (HTML), –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—ë, –∏–Ω–∞—á–µ - —Ç–µ–∫—Å—Ç
                                if (schedule[key].hasStructure) {
                                    cell.innerHTML = schedule[key].text;
                                } else {
                                    cell.textContent = schedule[key].text;
                                }
                            }
                        }
                    });
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', e);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ localStorage
        function saveSchedule() {
            const schedule = {};
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                const day = cell.getAttribute('data-day');
                const time = cell.getAttribute('data-time');
                if (day && time) {
                    // –î–ª—è —è—á–µ–µ–∫ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ—Å—å HTML, –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö - —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
                    const hasStructure = cell.querySelector('.schedule-main-action, .schedule-sub-action');
                    const content = hasStructure ? cell.innerHTML.trim() : cell.textContent.trim();
                    if (content) {
                        schedule[`${day}_${time}`] = {
                            day: day,
                            time: time,
                            text: content,
                            hasStructure: !!hasStructure
                        };
                    }
                }
            });
            localStorage.setItem('makc_2026_schedule', JSON.stringify(schedule));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function initScheduleHandlers() {
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.addEventListener('blur', saveSchedule);
                cell.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
        }

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–ù–ï–í–ù–ò–ö–ê ==========
        let diaryEntries = [];
        
        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–ò–†–ê–ú–ò–î–´ –¶–ï–õ–ï–ô ==========
        const API_BASE_URL = 'https://marabot.tw1.ru/api/tables';
        
        // –ö—ç—à —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–∏—Ä–∞–º–∏–¥—ã (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î): id -> {name, color}
        let pyramidLevelsCache = {};
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ/—É—Å—Ç–∞–Ω–æ–≤–∫–∞ user_id (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = 1)
        function getUserId() {
            let userId = localStorage.getItem('makc_2026_user_id');
            if (!userId) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π user_id = 1
                userId = '1';
                localStorage.setItem('makc_2026_user_id', userId);
            }
            return parseInt(userId);
        }

        // API —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–Ω–µ–≤–Ω–∏–∫–æ–º
        async function fetchDiaryEntries() {
            const userId = getUserId();
            if (!userId) {
                // Fallback –Ω–∞ localStorage
                loadDiaryFromLocalStorage();
                return;
            }

            try {
                const url = `${API_BASE_URL}/2026_diary?where.user_id=${userId}&order=entry_date:desc`;
                console.log('–ó–∞–ø—Ä–æ—Å –∫ API:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    // mode: 'cors' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('–û—Ç–≤–µ—Ç –æ—Ç API:', data);
                
                if (data.rows) {
                    diaryEntries = data.rows.map(row => ({
                        id: row.id,
                        db_id: row.id, // ID –∏–∑ –ë–î
                        date: formatDiaryDate(row.entry_date),
                        timestamp: new Date(row.entry_date).getTime(),
                        text: row.entry_text,
                        ai_comment: row.ai_comment || null,
                        ai_goal_alignment_percent: row.ai_goal_alignment_percent || null,
                        ai_comment_created_at: row.ai_comment_created_at || null,
                        ai_feedback_like: row.ai_feedback_like || false,
                        ai_feedback_dislike: row.ai_feedback_dislike || false
                    }));
                    renderDiary();
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${diaryEntries.length} –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î`);
                    
                    // AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∞
                    // const entriesWithoutComments = diaryEntries.filter(e => 
                    //     e.db_id && (!e.ai_comment || !e.ai_comment.trim())
                    // );
                    // if (entriesWithoutComments.length > 0) {
                    //     console.log(`üîÑ –ù–∞–π–¥–µ–Ω–æ ${entriesWithoutComments.length} –∑–∞–ø–∏—Å–µ–π –±–µ–∑ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –Ω–∞—á–∏–Ω–∞—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é...`);
                    //     // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä
                    //     entriesWithoutComments.forEach((entry, index) => {
                    //         setTimeout(() => {
                    //             generateAIComment(entry).catch(err => {
                    //                 console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∑–∞–ø–∏—Å–∏ #${entry.db_id}:`, err);
                    //             });
                    //         }, index * 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    //     });
                    // }
                } else {
                    console.warn('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);
                    diaryEntries = [];
                    renderDiary();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ë–î
                updateDBStatus(true);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏–∑ –ë–î:', error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
                    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –¥–ª—è CORS –æ—à–∏–±–æ–∫, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage
                } else {
                    console.warn('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
                }
                loadDiaryFromLocalStorage();
                updateDBStatus(false);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (–¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–∞)
        function updateDBStatus(connected) {
            const statusEl = document.getElementById('db-status');
            if (statusEl) {
                if (connected) {
                    statusEl.textContent = '‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –ë–î';
                    statusEl.style.color = '#27ae60';
                } else {
                    statusEl.textContent = '‚ö† –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ';
                    statusEl.style.color = '#f39c12';
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (–¥–ª—è –ø–∏—Ä–∞–º–∏–¥—ã)
        function updatePyramidDBStatus(connected) {
            const statusEl = document.getElementById('db-status');
            if (statusEl) {
                if (connected) {
                    statusEl.textContent = '‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –ë–î';
                    statusEl.style.color = '#27ae60';
                } else {
                    statusEl.textContent = '‚ö† –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ';
                    statusEl.style.color = '#f39c12';
                }
            }
        }

        async function saveDiaryEntryToDB(entry) {
            const userId = getUserId();

            try {
                const entryData = {
                    user_id: userId,
                    entry_text: entry.text,
                    entry_date: new Date(entry.timestamp).toISOString()
                };

                if (entry.db_id) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏
                    const response = await fetch(`${API_BASE_URL}/2026_diary/${entry.db_id}`, {
                        method: 'PATCH',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(entryData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return true;
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
                    const response = await fetch(`${API_BASE_URL}/2026_diary`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(entryData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    if (result.id) {
                        entry.db_id = result.id;
                        entry.id = result.id; // –û–±–Ω–æ–≤–ª—è–µ–º ID
                    }
                    return true;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î:', error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS. –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ.');
                }
                return false; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º false, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
            }
        }

        async function deleteDiaryEntryFromDB(entryId) {
            try {
                const response = await fetch(`${API_BASE_URL}/2026_diary/${entryId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î:', error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS. –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ.');
                }
                return false;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞
        async function generateAIComment(entry) {
            if (!entry.db_id) {
                console.warn('‚ö†Ô∏è –ù–µ–ª—å–∑—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –∑–∞–ø–∏—Å—å –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î');
                return null;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            if (entry.ai_comment && entry.ai_comment.trim()) {
                console.log('‚ÑπÔ∏è –£ –∑–∞–ø–∏—Å–∏ —É–∂–µ –µ—Å—Ç—å AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é');
                return null;
            }

            console.log(`üöÄ –ù–∞—á–∏–Ω–∞—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ #${entry.db_id}...`);

            try {
                const userId = getUserId();
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π URL –∫ API (–Ω–µ —á–µ—Ä–µ–∑ /api/tables)
                const apiUrl = 'https://marabot.tw1.ru/api-diary-generate-comment';
                
                const requestData = {
                    diary_entry_id: entry.db_id,
                    user_id: userId,
                    entry_text: entry.text,
                    include_context: true
                };
                
                console.log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ ${apiUrl}:`, requestData);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                console.log(`üì• –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`‚ùå HTTP ${response.status}: ${errorText}`);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log('üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç API:', result);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å —Å AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
                if (result.ai_comment) {
                    entry.ai_comment = result.ai_comment;
                    entry.ai_goal_alignment_percent = result.goal_alignment_percent || null;
                    entry.ai_comment_created_at = result.created_at || new Date().toISOString();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤–µ
                    const index = diaryEntries.findIndex(e => e.id === entry.id || e.db_id === entry.db_id);
                    if (index !== -1) {
                        diaryEntries[index] = entry;
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    saveDiaryToLocalStorage();
                    
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–Ω–µ–≤–Ω–∏–∫
                    renderDiary();
                    
                    console.log('‚úÖ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
                    return result;
                } else {
                    console.warn('‚ö†Ô∏è API –≤–µ—Ä–Ω—É–ª –æ—Ç–≤–µ—Ç –±–µ–∑ ai_comment:', result);
                }
                
                return null;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:', error);
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', {
                    message: error.message,
                    stack: error.stack,
                    entry_id: entry.db_id,
                    entry_text_preview: entry.text?.substring(0, 50) + '...'
                });
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                return null;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        window.toggleAIComment = function(commentId) {
            const content = document.getElementById(`${commentId}-content`);
            const toggle = document.getElementById(`${commentId}-toggle`);
            if (content && toggle) {
                if (content.classList.contains('collapsed')) {
                    content.classList.remove('collapsed');
                    toggle.textContent = '‚ñ≤ –°–≤–µ—Ä–Ω—É—Ç—å';
                } else {
                    content.classList.add('collapsed');
                    toggle.textContent = '‚ñº –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
                }
            }
        };

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é (Like/Dislike)
        window.sendAIFeedback = async function(entryId, isLike) {
            try {
                const apiUrl = 'https://marabot.tw1.ru/api-diary-ai-feedback';
                const entry = diaryEntries.find(e => e.id === entryId || e.db_id === entryId);
                
                if (!entry || !entry.db_id) {
                    console.warn('‚ö†Ô∏è –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å: –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î');
                    return false;
                }

                const response = await fetch(apiUrl, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        diary_entry_id: entry.db_id,
                        ai_feedback_like: isLike ? true : null,
                        ai_feedback_dislike: !isLike ? true : null
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                if (entry) {
                    if (isLike) {
                        entry.ai_feedback_like = true;
                        entry.ai_feedback_dislike = false;
                    } else {
                        entry.ai_feedback_like = false;
                        entry.ai_feedback_dislike = true;
                    }
                    saveDiaryToLocalStorage();
                }

                console.log(`‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${isLike ? 'Like' : 'Dislike'}`);
                return true;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏:', error);
                return false;
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function formatDiaryDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage (fallback)
        async function loadDiaryFromLocalStorage() {
            const saved = localStorage.getItem('makc_2026_diary');
            if (saved) {
                try {
                    const localEntries = JSON.parse(saved);
                    diaryEntries = localEntries;
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ localStorage –≤ –ë–î (–µ—Å–ª–∏ –æ–Ω–∏ –µ—â—ë –Ω–µ —Ç–∞–º)
                    await migrateLocalEntriesToDB(localEntries);
                    
                    renderDiary();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞:', e);
                    diaryEntries = [];
                    renderDiary();
                }
            } else {
                diaryEntries = [];
                renderDiary();
            }
        }

        // –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π –∏–∑ localStorage –≤ –ë–î
        async function migrateLocalEntriesToDB(localEntries) {
            if (!localEntries || localEntries.length === 0) return;
            
            console.log(`üîÑ –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ ${localEntries.length} –∑–∞–ø–∏—Å–µ–π –∏–∑ localStorage –≤ –ë–î...`);
            
            for (const entry of localEntries) {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î
                if (entry.db_id) {
                    console.log(`‚è≠Ô∏è –ó–∞–ø–∏—Å—å ${entry.id} —É–∂–µ –≤ –ë–î (db_id: ${entry.db_id}), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);
                    continue;
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
                const saved = await saveDiaryEntryToDB(entry);
                if (saved) {
                    console.log(`‚úÖ –ó–∞–ø–∏—Å—å ${entry.id} —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –ë–î (–Ω–æ–≤—ã–π db_id: ${entry.db_id})`);
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤–µ
                    const index = diaryEntries.findIndex(e => e.id === entry.id);
                    if (index !== -1) {
                        diaryEntries[index] = entry;
                    }
                } else {
                    console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–ø–∏—Å—å ${entry.id} –≤ –ë–î. –û—Å—Ç–∞—ë—Ç—Å—è –≤ localStorage.`);
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ localStorage
            saveDiaryToLocalStorage();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage (backup)
        function saveDiaryToLocalStorage() {
            localStorage.setItem('makc_2026_diary', JSON.stringify(diaryEntries));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π –¥–Ω–µ–≤–Ω–∏–∫–∞
        async function loadDiary() {
            try {
                await fetchDiaryEntries();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏–∑ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage:', error);
                await loadDiaryFromLocalStorage();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        window.addDiaryEntry = async function() {
            const textarea = document.getElementById('diary-text');
            const text = textarea.value.trim();
            
            if (!text) {
                alert('–í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∏!');
                return;
            }

            const now = Date.now();
            const entry = {
                id: now, // –í—Ä–µ–º–µ–Ω–Ω—ã–π ID
                date: formatDiaryDate(new Date(now).toISOString()),
                timestamp: now,
                text: text,
                ai_goal_alignment_percent: null
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
            const savedToDB = await saveDiaryEntryToDB(entry);
            
            if (savedToDB) {
                diaryEntries.unshift(entry); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                saveDiaryToLocalStorage(); // Backup –≤ localStorage
                renderDiary();
                textarea.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                
                // üÜï –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ —Ñ–æ–Ω–µ
                // AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
                // generateAIComment(entry).then(() => {
                Promise.resolve().then(() => {
                    console.log('üí¨ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
                }).catch(err => {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:', err);
                });
                
            } else {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î. –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ.');
                diaryEntries.unshift(entry);
                saveDiaryToLocalStorage();
                renderDiary();
                textarea.value = '';
            }
        };

        // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        window.deleteDiaryEntry = async function(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) return;
            
            const entry = diaryEntries.find(e => e.id === id || e.db_id === id);
            if (!entry) return;

            // –£–¥–∞–ª—è–µ–º –∏–∑ –ë–î –µ—Å–ª–∏ –µ—Å—Ç—å db_id
            if (entry.db_id) {
                const deletedFromDB = await deleteDiaryEntryFromDB(entry.db_id);
                if (!deletedFromDB) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –ë–î. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
                    return;
                }
            }

            diaryEntries = diaryEntries.filter(e => e.id !== id && e.db_id !== id);
            saveDiaryToLocalStorage();
            renderDiary();
        };

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        window.editDiaryEntry = async function(id) {
            const entry = diaryEntries.find(e => e.id === id || e.db_id === id);
            if (!entry) return;

            const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å:', entry.text);
            if (newText === null || !newText.trim()) return;

            entry.text = newText.trim();
            entry.date = formatDiaryDate(new Date().toISOString());
            entry.timestamp = Date.now();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
            const saved = await saveDiaryEntryToDB(entry);
            if (saved) {
                saveDiaryToLocalStorage();
                renderDiary();
            } else {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.');
                saveDiaryToLocalStorage();
                renderDiary();
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–Ω–µ–≤–Ω–∏–∫–∞
        function renderDiary() {
            const container = document.getElementById('diary-entries');
            
            if (diaryEntries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –î–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é!</p>';
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            let totalProgress = 0;
            try {
                const progress = updateTotalProgress();
                totalProgress = (typeof progress === 'number' && !isNaN(progress)) ? progress : 0;
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:', e);
                totalProgress = 0;
            }
            
            container.innerHTML = diaryEntries.map(entry => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const progressPercent = entry.ai_goal_alignment_percent !== null && entry.ai_goal_alignment_percent !== undefined
                    ? entry.ai_goal_alignment_percent 
                    : (totalProgress > 0 ? Math.round(totalProgress) : null);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                const hasAIComment = entry.ai_comment && entry.ai_comment.trim();
                const commentId = `ai-comment-${entry.id || entry.db_id}`;
                const isLiked = entry.ai_feedback_like === true;
                const isDisliked = entry.ai_feedback_dislike === true;
                
                return `
                <div class="diary-entry" data-entry-id="${entry.id}">
                    <div class="diary-entry-header">
                        <div class="diary-entry-date">üìÖ ${entry.date}</div>
                        ${progressPercent !== null && progressPercent !== undefined ? `
                        <div class="diary-entry-progress">
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" style="width: ${progressPercent}%;"></div>
                            </div>
                            <span class="progress-text">${progressPercent}% –∫ —Ü–µ–ª—è–º</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="diary-entry-text">${entry.text.replace(/\n/g, '<br>')}</div>
                    ${hasAIComment ? `
                    <div class="diary-entry-ai-comment" id="${commentId}">
                        <div class="diary-entry-ai-comment-header" onclick="toggleAIComment('${commentId}')">
                            <div class="diary-entry-ai-comment-title">
                                üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π AI
                            </div>
                            <div class="diary-entry-ai-comment-toggle" id="${commentId}-toggle">‚ñº –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</div>
                        </div>
                        <div class="diary-entry-ai-comment-content collapsed" id="${commentId}-content">
                            ${entry.ai_comment.replace(/\n/g, '<br>')}
                            <div class="diary-entry-ai-feedback">
                                <button class="${isLiked ? 'liked' : ''}" onclick="sendAIFeedback(${entry.id}, true)" ${isLiked ? 'disabled' : ''}>
                                    üëç –ù—Ä–∞–≤–∏—Ç—Å—è
                                </button>
                                <button class="${isDisliked ? 'disliked' : ''}" onclick="sendAIFeedback(${entry.id}, false)" ${isDisliked ? 'disabled' : ''}>
                                    üëé –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è
                                </button>
                            </div>
                        </div>
                    </div>
                    ` : (entry.db_id ? `
                    <div class="diary-entry-ai-comment-loading">
                        ‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...
                    </div>
                    ` : '')}
                    <div class="diary-entry-actions">
                        <button onclick="editDiaryEntry(${entry.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="delete-btn" onclick="deleteDiaryEntry(${entry.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `;
            }).join('');
            
            // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤—ë—Ä–Ω—É—Ç—ã–µ)
            diaryEntries.forEach(entry => {
                if (entry.ai_comment) {
                    const commentId = `ai-comment-${entry.id || entry.db_id}`;
                    const content = document.getElementById(`${commentId}-content`);
                    const toggle = document.getElementById(`${commentId}-toggle`);
                    if (content && toggle) {
                        content.classList.remove('collapsed');
                        toggle.textContent = '‚ñ≤ –°–≤–µ—Ä–Ω—É—Ç—å';
                    }
                }
            });
        }


        // ========== –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –ë–î –î–õ–Ø –ü–ò–†–ê–ú–ò–î–´ ==========
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–ª–µ–π –∏–∑ –ë–î
        async function loadGoalsFromDB() {
            const userId = getUserId();
            
            try {
                const url = `${API_BASE_URL}/2026_goal?where.user_id=${userId}&order=level_id:asc,id:asc`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.rows && Array.isArray(data.rows)) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç goals
                    const dbGoals = data.rows.map(row => ({
                        id: row.id,
                        db_id: row.id, // –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                        title: row.goal,
                        status: row.status || 'not_started',
                        progress: row.progress || 0,
                        criteria: row.criteria || '',
                        subtasks: [], // TODO: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–¥–∑–∞–¥–∞—á
                        priority: row.priority || null,
                        notes: row.notes || '',
                        maslowLevel: row.level_id || 1,
                        price: parseFloat(row.price) || 0,
                        quantity: parseInt(row.quantity) || 1,
                        total: parseFloat(row.total) || 0, // –ò—Å–ø–æ–ª—å–∑—É–µ–º total –∏–∑ –ë–î
                        hidden: row.hidden || false
                    }));
                    
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${dbGoals.length} —Ü–µ–ª–µ–π –∏–∑ –ë–î`);
                    return dbGoals;
                } else {
                    console.warn('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);
                    return [];
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π –∏–∑ –ë–î:', error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
                }
                return null; // null –æ–∑–Ω–∞—á–∞–µ—Ç –æ—à–∏–±–∫—É, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å localStorage
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏ –≤ –ë–î
        async function saveGoalToDB(goal) {
            const userId = getUserId();
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º level_id –∏–∑ maslowLevel (–æ–Ω–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç: 1-7)
                const levelId = goal.maslowLevel || 1;
                
                const goalData = {
                    user_id: userId,
                    level_id: levelId,
                    goal: goal.title,
                    price: goal.price || 0,
                    quantity: goal.quantity || 1,
                    progress: goal.progress || 0,
                    status: goal.status || 'not_started',
                    criteria: goal.criteria || '',
                    notes: goal.notes || '',
                    priority: goal.priority || null,
                    hidden: goal.hidden || false
                };
                
                if (goal.db_id) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ü–µ–ª–∏
                    const url = `${API_BASE_URL}/2026_goal/${goal.db_id}`;
                    console.log(`üîÑ –û–±–Ω–æ–≤–ª—è—é —Ü–µ–ª—å "${goal.title}" –≤ –ë–î:`, url, goalData);
                    
                    const response = await fetch(url, {
                        method: 'PATCH',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(goalData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`‚ùå HTTP ${response.status}: ${errorText}`);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const result = await response.json();
                    console.log(`‚úÖ –¶–µ–ª—å "${goal.title}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ –ë–î:`, result);
                    return true;
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ü–µ–ª–∏
                    const url = `${API_BASE_URL}/2026_goal`;
                    console.log(`üîÑ –°–æ–∑–¥–∞—é —Ü–µ–ª—å "${goal.title}" –≤ –ë–î:`, url, goalData);
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(goalData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`‚ùå HTTP ${response.status}: ${errorText}`);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const result = await response.json();
                    console.log(`‚úÖ –¶–µ–ª—å "${goal.title}" —Å–æ–∑–¥–∞–Ω–∞ –≤ –ë–î:`, result);
                    
                    if (result.id) {
                        goal.db_id = result.id;
                        goal.id = result.id; // –û–±–Ω–æ–≤–ª—è–µ–º ID
                    }
                    return true;
                }
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–ª–∏ "${goal.title}" –≤ –ë–î:`, error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS.');
                }
                return false;
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –∏–∑ –ë–î
        async function deleteGoalFromDB(goalId) {
            try {
                const response = await fetch(`${API_BASE_URL}/2026_goal/${goalId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–ª–∏ –∏–∑ –ë–î:', error);
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    console.warn('CORS –æ—à–∏–±–∫–∞: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS. –¶–µ–ª—å —É–¥–∞–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ.');
                }
                return false;
            }
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –®–ê–ì–ê–ú–ò ==========
        
        // –ö—ç—à —à–∞–≥–æ–≤: goal_id -> [steps]
        let goalStepsCache = {};
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Ü–µ–ª–∏ –∏–∑ –ë–î
        async function loadStepsFromDB(goalId) {
            const userId = getUserId();
            
            try {
                const url = `${API_BASE_URL}/2026_goal_steps?where.goal_id=${goalId}&where.user_id=${userId}&order=order_index:asc,created_at:asc`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.rows && Array.isArray(data.rows)) {
                    goalStepsCache[goalId] = data.rows;
                    return data.rows;
                } else {
                    goalStepsCache[goalId] = [];
                    return [];
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–≥–æ–≤ –¥–ª—è —Ü–µ–ª–∏ ${goalId}:`, error);
                goalStepsCache[goalId] = [];
                return [];
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π
        async function loadAllSteps() {
            for (const goal of goals) {
                if (goal.id) {
                    await loadStepsFromDB(goal.id);
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—Å–∫—Ä—ã—Ç—ã—Ö –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
        function saveAccordionState() {
            const expandedGoals = new Set();
            document.querySelectorAll('.goal-steps-accordion[style*="block"]').forEach(accordion => {
                const goalId = accordion.id.replace('steps-toggle-', '');
                expandedGoals.add(parseInt(goalId));
            });
            return expandedGoals;
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
        function restoreAccordionState(expandedGoals) {
            expandedGoals.forEach(goalId => {
                const accordion = document.getElementById(`steps-toggle-${goalId}`);
                const button = document.querySelector(`[data-goal-id="${goalId}"] .steps-toggle-btn`);
                if (accordion && button) {
                    accordion.style.display = 'block';
                    button.setAttribute('aria-expanded', 'true');
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —à–∞–≥–∞ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
        async function updateStepStatus(stepId, newStatus, progress = null) {
            // –ù–∞—Ö–æ–¥–∏–º goalId –∏–∑ –∫—ç—à–∞ –î–û –∑–∞–ø—Ä–æ—Å–∞
            let goalId = null;
            let stepIndex = -1;
            let oldStepData = null;
            
            for (const gId in goalStepsCache) {
                const index = goalStepsCache[gId].findIndex(s => s.id === stepId);
                if (index !== -1) {
                    goalId = parseInt(gId);
                    stepIndex = index;
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–∫–∞—Ç–∞
                    oldStepData = {...goalStepsCache[goalId][index]};
                    break;
                }
            }
            
            if (!goalId || stepIndex === -1) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —à–∞–≥ –≤ –∫—ç—à–µ');
            }
            
            // –û–ü–¢–ò–ú–ò–°–¢–ò–ß–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï: —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
            goalStepsCache[goalId][stepIndex].status = newStatus;
            if (newStatus === 'completed') {
                goalStepsCache[goalId][stepIndex].completed_at = new Date().toISOString();
            } else {
                goalStepsCache[goalId][stepIndex].completed_at = null;
            }
            
            if (progress !== null) {
                goalStepsCache[goalId][stepIndex].progress = progress;
            }
            
            // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º UI (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ!)
            updateGoalDisplay(goalId, stepId);
            await updateGoalProgressFromSteps(goalId);
            
            // –¢–µ–ø–µ—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º UI)
            try {
                const updateData = {
                    status: newStatus,
                    updated_at: new Date().toISOString()
                };
                
                if (newStatus === 'completed') {
                    updateData.completed_at = new Date().toISOString();
                } else if (newStatus !== 'completed' && newStatus !== 'in_progress') {
                    updateData.completed_at = null;
                }
                
                if (progress !== null) {
                    updateData.progress = progress;
                }
                
                const response = await fetch(`${API_BASE_URL}/2026_goal_steps/${stepId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                if (result.affected === 0) {
                    throw new Error('–®–∞–≥ –Ω–µ –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω');
                }
                
                // –£—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                return goalId;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —à–∞–≥–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º:', error);
                
                // –û–¢–ö–ê–¢: –µ—Å–ª–∏ –æ—à–∏–±–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                goalStepsCache[goalId][stepIndex] = oldStepData;
                updateGoalDisplay(goalId, stepId);
                await updateGoalProgressFromSteps(goalId);
                
                throw error;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ü–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤
        async function updateGoalProgressFromSteps(goalId) {
            const steps = goalStepsCache[goalId] || [];
            if (steps.length === 0) return;
            
            const completedSteps = steps.filter(s => s.status === 'completed').length;
            const totalSteps = steps.filter(s => s.status !== 'cancelled').length;
            const newProgress = totalSteps > 0 ? Math.round((completedSteps / totalSteps) * 100) : 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏ –≤ –ë–î
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                goal.progress = newProgress;
                await saveGoalToDB(goal);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ (–±–µ–∑ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –≤—Å–µ–π –ø–∏—Ä–∞–º–∏–¥—ã)
        function updateGoalDisplay(goalId, updatedStepId = null) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const goalItem = document.querySelector(`[data-goal-id="${goalId}"]`);
            if (!goalItem) return;
            
            const progress = calculateGoalProgress(goal);
            const steps = goalStepsCache[goalId] || [];
            const completedSteps = steps.filter(s => s.status === 'completed').length;
            const totalSteps = steps.filter(s => s.status !== 'cancelled').length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progressEl = goalItem.querySelector('.level-goal-progress');
            if (progressEl) {
                progressEl.textContent = `${progress}%`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ —à–∞–≥–æ–≤ –≤ –∫–Ω–æ–ø–∫–µ
            const toggleBtn = goalItem.querySelector('.steps-toggle-btn');
            if (toggleBtn && steps.length > 0) {
                const toggleText = toggleBtn.querySelector('.steps-toggle-text');
                if (toggleText) {
                    toggleText.textContent = `–®–∞–≥–∏ (${completedSteps}/${totalSteps})`;
                }
            }
            
            // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—ë–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ–≥–æ, –∏–Ω–∞—á–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
            if (updatedStepId) {
                const stepItem = document.querySelector(`[data-step-id="${updatedStepId}"]`);
                if (stepItem) {
                    const step = steps.find(s => s.id === updatedStepId);
                    if (step) {
                        const checkbox = stepItem.querySelector('.step-checkbox');
                        if (checkbox) {
                            checkbox.checked = step.status === 'completed';
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã
                        stepItem.className = `goal-step-item ${step.status === 'completed' ? 'completed' : ''} ${step.status === 'in_progress' ? 'in-progress' : ''}`;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –µ—Å—Ç—å
                        const progressSpan = stepItem.querySelector('.step-progress');
                        if (step.progress !== null) {
                            if (progressSpan) {
                                progressSpan.textContent = ` (${step.progress}%)`;
                            } else {
                                const progressEl = document.createElement('span');
                                progressEl.className = 'step-progress';
                                progressEl.textContent = ` (${step.progress}%)`;
                                stepItem.appendChild(progressEl);
                            }
                        } else if (progressSpan) {
                            progressSpan.remove();
                        }
                    }
                }
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥)
                const accordion = document.getElementById(`steps-toggle-${goalId}`);
                if (accordion) {
                    const stepsList = accordion.querySelector('.goal-steps-list');
                    if (stepsList) {
                        stepsList.innerHTML = steps.map(step => {
                            const stepIcon = step.step_type === 'book' ? 'üìñ' : 
                                             step.step_type === 'film' ? 'üé¨' : 
                                             step.step_type === 'course' ? 'üìö' : '‚úì';
                            const isCompleted = step.status === 'completed';
                            const isInProgress = step.status === 'in_progress';
                            const progressText = step.progress !== null ? ` (${step.progress}%)` : '';
                            
                            return `
                                <div class="goal-step-item ${isCompleted ? 'completed' : ''} ${isInProgress ? 'in-progress' : ''}" 
                                     data-step-id="${step.id}">
                                    <input type="checkbox" 
                                           ${isCompleted ? 'checked' : ''}
                                           onchange="toggleStepStatus(${step.id}, this.checked, ${goal.id})"
                                           class="step-checkbox">
                                    <span class="step-icon">${stepIcon}</span>
                                    <span class="step-name">${step.step_name}</span>
                                    ${progressText ? `<span class="step-progress">${progressText}</span>` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                }
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —à–∞–≥–∞
        async function toggleStepStatus(stepId, isChecked, goalId) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
            const expandedGoals = saveAccordionState();
            
            const newStatus = isChecked ? 'completed' : 'not_started';
            
            try {
                const updatedGoalId = await updateStepStatus(stepId, newStatus);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
                restoreAccordionState(expandedGoals);
            } catch (error) {
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ–∫–±–æ–∫—Å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                const checkbox = document.querySelector(`[data-step-id="${stepId}"] .step-checkbox`);
                if (checkbox) {
                    checkbox.checked = !isChecked;
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
                restoreAccordionState(expandedGoals);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–µ–µ)
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —à–∞–≥:', error);
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —à–∞–≥–æ–≤ (–∞–∫–∫–æ—Ä–¥–µ–æ–Ω)
        function toggleGoalSteps(goalId) {
            const accordion = document.getElementById(`steps-toggle-${goalId}`);
            const goalItem = document.querySelector(`[data-goal-id="${goalId}"]`);
            const button = goalItem?.querySelector('.steps-toggle-btn');
            
            if (!accordion || !button) {
                console.warn('–ê–∫–∫–æ—Ä–¥–µ–æ–Ω –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è goalId:', goalId);
                return;
            }
            
            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            
            if (isExpanded) {
                accordion.style.display = 'none';
                button.setAttribute('aria-expanded', 'false');
            } else {
                accordion.style.display = 'block';
                button.setAttribute('aria-expanded', 'true');
            }
        }
        
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–ª–µ–π)
        (async () => {
            await loadData(); // loadData —É–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–≥–∏ —á–µ—Ä–µ–∑ loadAllSteps()
            renderMaslowPyramid();
            updateTotalProgress();
            loadSchedule();
            initScheduleHandlers();
        })();
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π user_id
        const userIdEl = document.getElementById('current-user-id');
        if (userIdEl) {
            userIdEl.textContent = getUserId();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–Ω–µ–≤–Ω–∏–∫
        loadDiary();

        // ===== –ì–æ–¥–æ–≤–æ–π —Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ =====
        (function initYearTracker() {
            const YEAR = 2026;
            const START_DATE = new Date(YEAR, 0, 1); // 1 —è–Ω–≤–∞—Ä—è 2026
            const END_DATE = new Date(YEAR, 11, 31); // 31 –¥–µ–∫–∞–±—Ä—è 2026
            
            const STORAGE_KEY = 'year_habits_v1';
            const TIME_SLOTS = [
                { start: '10:00', end: '19:00', sphere: '–ë–∏–∑–Ω–µ—Å', label: '–†–∞–±–æ—Ç–∞' },
            ];
            
            const defaultHabits = TIME_SLOTS.map((_, idx) => `slot_${String(idx + 1).padStart(2, '0')}`);
            let habits = defaultHabits.slice();
            
            function saveState(state){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
            function loadState(){ 
                try{ 
                    const rawData = localStorage.getItem(STORAGE_KEY);
                    const data = JSON.parse(rawData || '{}');
                    
                    // –û—Ç–ª–∞–¥–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–Ω–µ–π 6 –∏ 7
                    if (data['slot_01__6'] !== undefined) {
                        console.log('üîç –û—Ç–ª–∞–¥–∫–∞ localStorage –¥–ª—è –¥–Ω—è 6:', 'slot_01__6 =', data['slot_01__6'], '—Ç–∏–ø:', typeof data['slot_01__6']);
                    }
                    if (data['slot_01__7'] !== undefined) {
                        console.log('üîç –û—Ç–ª–∞–¥–∫–∞ localStorage –¥–ª—è –¥–Ω—è 7:', 'slot_01__7 =', data['slot_01__7'], '—Ç–∏–ø:', typeof data['slot_01__7']);
                    }
                    
                    // –û—á–∏—â–∞–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ - —Å—Ç—Ä–æ–∫–∞ (–Ω–µ boolean), —É–¥–∞–ª—è–µ–º –µ–≥–æ
                    const cleaned = {};
                    let hasInvalidData = false;
                    for (const key in data) {
                        // –ü—Ä–∏–Ω–∏–º–∞–µ–º —Ç–æ–ª—å–∫–æ boolean –∑–Ω–∞—á–µ–Ω–∏—è (true/false)
                        if (data[key] === true || data[key] === false) {
                            cleaned[key] = data[key];
                        } else {
                            // –£–¥–∞–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞ –∏ —Ç.–¥.)
                            console.warn('‚ö†Ô∏è –£–¥–∞–ª—ë–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ localStorage:', key, '=', data[key], '(—Ç–∏–ø:', typeof data[key], ')');
                            hasInvalidData = true;
                        }
                    }
                    if (hasInvalidData) {
                        console.log('üßπ –û—á–∏—Å—Ç–∫–∞ localStorage: —É–¥–∞–ª–µ–Ω–æ', Object.keys(data).length - Object.keys(cleaned).length, '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π');
                        saveState(cleaned); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    }
                    return cleaned;
                }catch(e){ 
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ localStorage:', e);
                    return {}; 
                } 
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –¥–Ω–∏ –≥–æ–¥–∞ (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–Ω–µ)
            const DAYS = [];
            const currentDate = new Date(START_DATE);
            while (currentDate <= END_DATE) {
                DAYS.push({
                    date: new Date(currentDate),
                    day: currentDate.getDate(),
                    month: currentDate.getMonth(),
                    year: currentDate.getFullYear(),
                    weekday: currentDate.getDay(), // 0=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6=—Å—É–±–±–æ—Ç–∞
                    monthName: getMonthNameForTracker(currentDate.getMonth())
                });
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            function getMonthNameForTracker(monthIndex) {
                const names = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å',
                              '–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
                return names[monthIndex];
            }
            
            function getWeekdayShort(weekday) {
                const names = ['–≤—Å','–ø–Ω','–≤—Ç','—Å—Ä','—á—Ç','–ø—Ç','—Å–±'];
                return names[weekday];
            }
            
            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–Ω—è –¥–ª—è –ø—Ä–∏–≤—ã—á–∫–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç nov.html)
            function isActiveDay(habit, day){
                // day - –Ω–æ–º–µ—Ä –¥–Ω—è –≤ –≥–æ–¥—É (1-365)
                const dayObj = DAYS[day - 1];
                if (!dayObj) return false;
                
                const habitIndex = habits.indexOf(habit);
                if (habitIndex === -1) return true;
                
                const slot = TIME_SLOTS[habitIndex] || {};
                
                // –î–ª—è "–†–∞–±–æ—Ç–∞": –ø–Ω-–ø—Ç, —Å 19 —è–Ω–≤–∞—Ä—è –ø–æ 24 –¥–µ–∫–∞–±—Ä—è
                if (slot.label === '–†–∞–±–æ—Ç–∞') {
                    const startDate = new Date(2026, 0, 19); // 19 —è–Ω–≤–∞—Ä—è
                    const endDate = new Date(2026, 11, 24); // 24 –¥–µ–∫–∞–±—Ä—è
                    const dayDate = new Date(dayObj.year, dayObj.month, dayObj.day);
                    if (dayDate < startDate || dayDate > endDate) return false;
                    // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ (1) - –ü—è—Ç–Ω–∏—Ü–∞ (5)
                    return dayObj.weekday >= 1 && dayObj.weekday <= 5;
                }
                
                return true;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            const monthGroups = {};
            DAYS.forEach((dayObj) => {
                const key = `${dayObj.month}-${dayObj.monthName}`;
                if (!monthGroups[key]) {
                    monthGroups[key] = {
                        monthIndex: dayObj.month,
                        monthName: dayObj.monthName,
                        count: 0
                    };
                }
                monthGroups[key].count++;
            });
            
            // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const today = new Date();
            const isCurrentYear = today.getFullYear() === YEAR;
            const todayIndex = isCurrentYear ? 
                DAYS.findIndex(d => 
                    d.date.getTime() === new Date(today.getFullYear(), today.getMonth(), today.getDate()).getTime()
                ) : -1;
            
            function buildYearTrackerTable() {
                const headerRow = document.getElementById('year-tracker-header');
                const tbody = document.getElementById('year-tracker-body');
                const totalRow = document.getElementById('year-tracker-total');
                
                if (!headerRow || !tbody || !totalRow) {
                    console.warn('–≠–ª–µ–º–µ–Ω—Ç—ã —Ç—Ä–µ–∫–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–º–æ–∂–Ω–æ —Å–µ–∫—Ü–∏—è "–°–µ–≥–æ–¥–Ω—è" –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    return;
                }
                
                // –°—Ç—Ä–æ–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ (2 —Å—Ç—Ä–æ–∫–∏: –º–µ—Å—è—Ü—ã —Å–≤–µ—Ä—Ö—É, —á–∏—Å–ª–∞+–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ —Å–Ω–∏–∑—É)
                headerRow.innerHTML = '';
                
                // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ + –ù–∞—á, –ö–æ–Ω, –°—Ñ–µ—Ä–∞, –î–µ–π—Å—Ç–≤–∏–µ + –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–µ–≤ (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ —è—á–µ–π–∫–∏) + –ò–¢–û–ì–û
                const tr1 = document.createElement('tr');
                
                // –í–ê–ñ–ù–û: –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: #, –ù–∞—á, –ö–æ–Ω, –°—Ñ–µ—Ä–∞, –î–µ–π—Å—Ç–≤–∏–µ
                // –°—Ç–æ–ª–±–µ—Ü –Ω–æ–º–µ—Ä–∞ (rowspan=2)
                const th1 = document.createElement('th');
                th1.textContent = '#';
                th1.rowSpan = 2;
                th1.style.verticalAlign = 'middle';
                th1.style.textAlign = 'center';
                th1.setAttribute('data-col-index', '0');
                tr1.appendChild(th1);
                
                // –°—Ç–æ–ª–±—Ü—ã –ù–∞—á, –ö–æ–Ω, –°—Ñ–µ—Ä–∞, –î–µ–π—Å—Ç–≤–∏–µ (rowspan=2)
                const th2 = document.createElement('th');
                th2.textContent = '–ù–∞—á';
                th2.rowSpan = 2;
                th2.style.verticalAlign = 'middle';
                th2.style.textAlign = 'center';
                th2.setAttribute('data-col-index', '1');
                tr1.appendChild(th2);
                
                const th3 = document.createElement('th');
                th3.textContent = '–ö–æ–Ω';
                th3.rowSpan = 2;
                th3.style.verticalAlign = 'middle';
                th3.style.textAlign = 'center';
                th3.setAttribute('data-col-index', '2');
                tr1.appendChild(th3);
                
                const th4 = document.createElement('th');
                th4.textContent = '–°—Ñ–µ—Ä–∞';
                th4.rowSpan = 2;
                th4.style.verticalAlign = 'middle';
                th4.style.textAlign = 'center';
                th4.setAttribute('data-col-index', '3');
                tr1.appendChild(th4);
                
                const th5 = document.createElement('th');
                th5.textContent = '–î–µ–π—Å—Ç–≤–∏–µ';
                th5.rowSpan = 2;
                th5.style.verticalAlign = 'middle';
                th5.style.textAlign = 'left';
                th5.setAttribute('data-col-index', '4');
                tr1.appendChild(th5);
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Å—è—Ü—ã –ø–æ –ø–æ—Ä—è–¥–∫—É
                const sortedMonths = Object.keys(monthGroups).sort((a, b) => {
                    const monthA = parseInt(a.split('-')[0]);
                    const monthB = parseInt(b.split('-')[0]);
                    return monthA - monthB;
                });
                
                sortedMonths.forEach(key => {
                    const group = monthGroups[key];
                    const th = document.createElement('th');
                    th.className = 'month-header';
                    th.textContent = group.monthName;
                    th.colSpan = group.count;
                    th.style.verticalAlign = 'middle';
                    tr1.appendChild(th);
                });
                
                // –°—Ç–æ–ª–±–µ—Ü –ò–¢–û–ì–û (rowspan=2)
                const thTotal = document.createElement('th');
                thTotal.textContent = '–ò–¢–û–ì–û';
                thTotal.rowSpan = 2;
                thTotal.style.verticalAlign = 'middle';
                thTotal.style.textAlign = 'center';
                tr1.appendChild(thTotal);
                
                headerRow.appendChild(tr1);
                
                // –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: —á–∏—Å–ª–∞ –¥–Ω–µ–π –∏ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–ø–æ–¥ –∫–∞–∂–¥—ã–º –º–µ—Å—è—Ü–µ–º)
                const tr2 = document.createElement('tr');
                DAYS.forEach((dayObj, index) => {
                    const th = document.createElement('th');
                    if (dayObj.weekday === 0 || dayObj.weekday === 6) {
                        th.classList.add('weekend');
                    }
                    if (index === todayIndex) {
                        th.classList.add('today-cell');
                    }
                    th.innerHTML = `<div class="day-number">${dayObj.day}</div><div class="day-weekday">${getWeekdayShort(dayObj.weekday)}</div>`;
                    th.setAttribute('data-day', index + 1);
                    th.setAttribute('data-date', `${dayObj.year}-${String(dayObj.month + 1).padStart(2, '0')}-${String(dayObj.day).padStart(2, '0')}`);
                    th.setAttribute('title', `${dayObj.day} ${dayObj.monthName} ${dayObj.year} (${getWeekdayShort(dayObj.weekday)})`);
                    tr2.appendChild(th);
                });
                headerRow.appendChild(tr2);
                
                // –°—Ç—Ä–æ–∫–∞ –∏—Ç–æ–≥–æ–≤
                totalRow.innerHTML = '';
                
                // 1. –°—Ç–æ–ª–±–µ—Ü # (–ø—É—Å—Ç–æ)
                const td1 = document.createElement('td');
                td1.style.padding = '10px';
                td1.style.background = '#f9fafb';
                td1.style.border = '1px solid #e5e7eb';
                totalRow.appendChild(td1);
                
                // 2. –°—Ç–æ–ª–±–µ—Ü –ù–∞—á (–ø—É—Å—Ç–æ)
                const td2 = document.createElement('td');
                td2.style.padding = '10px';
                td2.style.background = '#f9fafb';
                td2.style.border = '1px solid #e5e7eb';
                totalRow.appendChild(td2);
                
                // 3. –°—Ç–æ–ª–±–µ—Ü –ö–æ–Ω (–ø—É—Å—Ç–æ)
                const td3 = document.createElement('td');
                td3.style.padding = '10px';
                td3.style.background = '#f9fafb';
                td3.style.border = '1px solid #e5e7eb';
                totalRow.appendChild(td3);
                
                // 4. –°—Ç–æ–ª–±–µ—Ü –°—Ñ–µ—Ä–∞ (–ø—É—Å—Ç–æ)
                const td4 = document.createElement('td');
                td4.style.padding = '10px';
                td4.style.background = '#f9fafb';
                td4.style.border = '1px solid #e5e7eb';
                totalRow.appendChild(td4);
                
                // 5. –°—Ç–æ–ª–±–µ—Ü –î–µ–π—Å—Ç–≤–∏–µ ("–ò–¢–û–ì–û (–¥–µ–Ω—å)")
                const td5 = document.createElement('td');
                td5.textContent = '–ò–¢–û–ì–û (–¥–µ–Ω—å)';
                td5.style.padding = '10px';
                td5.style.background = '#f9fafb';
                td5.style.border = '1px solid #e5e7eb';
                td5.style.textAlign = 'left';
                td5.style.fontWeight = '600';
                totalRow.appendChild(td5);
                // –°—Ç–æ–ª–±—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
                DAYS.forEach((dayObj, index) => {
                    const td = document.createElement('td');
                    td.style.padding = '10px';
                    td.style.fontWeight = '600';
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–Ω—è (–¥–ª—è –ø–µ—Ä–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ "–†–∞–±–æ—Ç–∞")
                    const day = index + 1;
                    const isActive = habits.length > 0 ? isActiveDay(habits[0], day) : false;
                    
                    // –¶–≤–µ—Ç–æ–≤–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    if (isActive) {
                        td.style.background = '#e3f2fd'; // –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (–ø–Ω-–ø—Ç)
                    } else {
                        td.style.background = '#f5f5f5'; // –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (—Å–±-–≤—Å)
                    }
                    
                    td.textContent = ''; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                    
                    if (index === todayIndex) {
                        td.classList.add('today-cell');
                    }
                    totalRow.appendChild(td);
                });
                // –°—Ç–æ–ª–±–µ—Ü –ò–¢–û–ì–û –≤ –∫–æ–Ω—Ü–µ
                const tdFinalTotal = document.createElement('td');
                tdFinalTotal.textContent = '‚Äî';
                tdFinalTotal.style.padding = '10px';
                tdFinalTotal.style.fontWeight = '600';
                totalRow.appendChild(tdFinalTotal);
                
                // –°—Ç—Ä–æ–∏–º —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç nov.html)
                // –í–ê–ñ–ù–û: –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º tbody –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫
                tbody.innerHTML = '';
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ tbody –ø—É—Å—Ç
                if (tbody.children.length > 0) {
                    console.warn('‚ö†Ô∏è tbody –Ω–µ –ø—É—Å—Ç –ø–æ—Å–ª–µ innerHTML = ""!', tbody.children.length, '—ç–ª–µ–º–µ–Ω—Ç–æ–≤');
                    while (tbody.firstChild) {
                        tbody.removeChild(tbody.firstChild);
                    }
                }
                
                if(!Array.isArray(habits) || habits.length === 0){
                    habits = defaultHabits.slice();
                }
                
                const state = loadState();
                habits.forEach((habit, index) => {
                    const tr = document.createElement('tr');
                    
                    // –í–ê–ñ–ù–û: –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏: #, –ù–∞—á, –ö–æ–Ω, –°—Ñ–µ—Ä–∞, –î–µ–π—Å—Ç–≤–∏–µ
                    // 1. –°—Ç–æ–ª–±–µ—Ü # (–Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –∏–Ω–¥–µ–∫—Å 0)
                    const numTd = document.createElement('td');
                    numTd.textContent = String(index + 1);
                    numTd.className = 'muted';
                    numTd.setAttribute('data-col-index', '0');
                    tr.appendChild(numTd);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ TIME_SLOTS
                    const slot = TIME_SLOTS[index] || { start: '', end: '', sphere: '', label: '' };
                    
                    // 2. –°—Ç–æ–ª–±–µ—Ü –ù–∞—á (–Ω–∞—á–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏, –∏–Ω–¥–µ–∫—Å 1)
                    const startTd = document.createElement('td');
                    startTd.className = 'time-start';
                    startTd.textContent = slot.start || '';
                    startTd.setAttribute('data-col-index', '1');
                    tr.appendChild(startTd);
                    
                    // 3. –°—Ç–æ–ª–±–µ—Ü –ö–æ–Ω (–∫–æ–Ω–µ—Ü –≤—Ä–µ–º–µ–Ω–∏, –∏–Ω–¥–µ–∫—Å 2)
                    const endTd = document.createElement('td');
                    endTd.className = 'time-end';
                    endTd.textContent = slot.end || '';
                    endTd.setAttribute('data-col-index', '2');
                    tr.appendChild(endTd);
                    
                    // 4. –°—Ç–æ–ª–±–µ—Ü –°—Ñ–µ—Ä–∞ (–∏–Ω–¥–µ–∫—Å 3)
                    const sphereTd = document.createElement('td');
                    sphereTd.className = 'time-sphere';
                    sphereTd.textContent = slot.sphere || '';
                    sphereTd.setAttribute('data-col-index', '3');
                    tr.appendChild(sphereTd);
                    
                    // 5. –°—Ç–æ–ª–±–µ—Ü –î–µ–π—Å—Ç–≤–∏–µ (–∏–Ω–¥–µ–∫—Å 4)
                    const nameTd = document.createElement('td');
                    nameTd.dataset.habitKey = habit;
                    nameTd.textContent = slot.label || '';
                    nameTd.style.fontWeight = '600';
                    nameTd.style.color = '#111827';
                    nameTd.setAttribute('data-col-index', '4');
                    tr.appendChild(nameTd);
                    
                    // –û—Ç–ª–∞–¥–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ slot.label —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
                    if (index === 0) {
                        console.log('üîç –û—Ç–ª–∞–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–∫–∏:');
                        console.log('  slot:', slot);
                        console.log('  slot.label:', slot.label);
                        console.log('  nameTd.textContent:', nameTd.textContent);
                        console.log('  nameTd:', nameTd);
                        console.log('  –ü–æ—Ä—è–¥–æ–∫ —è—á–µ–µ–∫ –≤ —Å—Ç—Ä–æ–∫–µ:', Array.from(tr.children).map((td, i) => `${i}: ${td.textContent || '(–ø—É—Å—Ç–æ)'}`));
                    }

                    DAYS.forEach((dayObj, dayIndex) => {
                        const day = dayIndex + 1; // –ù–æ–º–µ—Ä –¥–Ω—è (1-365)
                        const td = document.createElement('td');
                        const active = isActiveDay(habit, day);
                        const key = `${habit}__${day}`;
                        // –í–ê–ñ–ù–û: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ value - —ç—Ç–æ —Å—Ç—Ä–æ–≥–æ boolean true, –Ω–µ —Å—Ç—Ä–æ–∫–∞!
                        const value = state[key] === true;
                        
                        // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –¥–Ω–µ–π 6 –∏ 7 —è–Ω–≤–∞—Ä—è (–∏–Ω–¥–µ–∫—Å—ã 5 –∏ 6, —Ç–∞–∫ –∫–∞–∫ –¥–µ–Ω—å 1 = –∏–Ω–¥–µ–∫—Å 0)
                        if (index === 0 && (day === 6 || day === 7)) {
                            console.log(`üîç –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –¥–Ω—è ${day} (–∏–Ω–¥–µ–∫—Å ${dayIndex}):`);
                            console.log('  key:', key);
                            console.log('  state[key]:', state[key], '—Ç–∏–ø:', typeof state[key]);
                            console.log('  value (state[key] === true):', value);
                        }
                        
                        // –í–ê–ñ–ù–û: —è–≤–Ω–æ –æ—á–∏—â–∞–µ–º textContent, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                        td.textContent = '';
                        
                        if(!active){
                            // –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (—Å–±-–≤—Å)
                            td.className = 'cell inactive';
                            td.style.background = '#f5f5f5'; // –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
                            if(value){ 
                                td.classList.remove('inactive'); 
                                td.classList.add('done'); 
                                td.style.background = '#81c784'; // –í—ã–ø–æ–ª–Ω–µ–Ω–æ - –º—è–≥–∫–∏–π –∑–µ–ª—ë–Ω—ã–π
                                td.textContent = '‚úì'; 
                            }
                        } else {
                            // –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (–ø–Ω-–ø—Ç)
                            td.className = 'cell empty';
                            if(value){ 
                                // –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                                td.classList.remove('empty'); 
                                td.classList.add('done'); 
                                td.style.background = '#81c784'; // –ú—è–≥–∫–∏–π –∑–µ–ª—ë–Ω—ã–π
                                td.textContent = '‚úì'; 
                            } else {
                                // –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                                td.style.background = '#fce4ec'; // –°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π
                                td.textContent = ''; // –Ø–≤–Ω–æ –æ—á–∏—â–∞–µ–º
                            }
                        }
                        
                        if (dayIndex === todayIndex) {
                            td.classList.add('today-cell');
                        }
                        
                        td.addEventListener('click', () => {
                            const curr = loadState();
                            const now = !(curr[key] === true);
                            curr[key] = now;
                            saveState(curr);
                            
                            if(now){ 
                                // –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                                td.classList.remove('empty', 'inactive'); 
                                td.classList.add('done'); 
                                td.style.background = '#81c784'; // –ú—è–≥–∫–∏–π –∑–µ–ª—ë–Ω—ã–π
                                td.textContent = '‚úì'; 
                            } else { 
                                // –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                                td.classList.remove('done'); 
                                if(active) {
                                    td.classList.add('empty'); 
                                    td.style.background = '#fce4ec'; // –°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π
                                } else {
                                    td.classList.add('inactive');
                                    td.style.background = '#f5f5f5'; // –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
                                }
                                td.textContent = ''; 
                            }
                            
                            updateRowPercent(tr, habit);
                            updateDayTotals();
                        });
                        tr.appendChild(td);
                    });

                    const totalTd = document.createElement('td');
                    totalTd.className = 'percent';
                    totalTd.textContent = calcRowPercent(habit) + '%';
                    tr.appendChild(totalTd);
                    
                    // –û—Ç–ª–∞–¥–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—è–¥–æ–∫ —è—á–µ–µ–∫ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ tbody
                    if (index === 0) {
                        console.log('üîç –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ tbody:');
                        console.log('  –í—Å–µ–≥–æ —è—á–µ–µ–∫ –≤ —Å—Ç—Ä–æ–∫–µ:', tr.children.length);
                        console.log('  –ü–æ—Ä—è–¥–æ–∫ —è—á–µ–µ–∫:', Array.from(tr.children).map((td, i) => {
                            const text = td.textContent || '(–ø—É—Å—Ç–æ)';
                            const className = td.className || '';
                            return `${i}: "${text.substring(0, 20)}" (${className})`;
                        }));
                        console.log('  –Ø—á–µ–π–∫–∞ #5 (–î–µ–π—Å—Ç–≤–∏–µ):', tr.children[4]?.textContent, tr.children[4]);
                    }
                    
                    tbody.appendChild(tr);
                    
                    // –û—Ç–ª–∞–¥–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ tbody
                    if (index === 0) {
                        setTimeout(() => {
                            console.log('üîç –û—Ç–ª–∞–¥–∫–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –≤ tbody:');
                            const row = tbody.querySelector('tr:first-child');
                            if (row) {
                                console.log('  –Ø—á–µ–π–∫–∞ #4 (–î–µ–π—Å—Ç–≤–∏–µ, –∏–Ω–¥–µ–∫—Å 4):', row.children[4]?.textContent, row.children[4]);
                                console.log('  –Ø—á–µ–π–∫–∞ #5 (–¥–µ–Ω—å 1, –∏–Ω–¥–µ–∫—Å 5):', row.children[5]?.textContent, row.children[5]);
                                // –î–µ–Ω—å 6 —è–Ω–≤–∞—Ä—è = –∏–Ω–¥–µ–∫—Å 5 (–¥–µ–Ω—å 1 = –∏–Ω–¥–µ–∫—Å 0, –¥–µ–Ω—å 6 = –∏–Ω–¥–µ–∫—Å 5)
                                // –ù–æ –≤ —Å—Ç—Ä–æ–∫–µ: #0=#, #1=–ù–∞—á, #2=–ö–æ–Ω, #3=–°—Ñ–µ—Ä–∞, #4=–î–µ–π—Å—Ç–≤–∏–µ, #5=–¥–µ–Ω—å1, #6=–¥–µ–Ω—å2, ..., #10=–¥–µ–Ω—å6, #11=–¥–µ–Ω—å7
                                console.log('  –Ø—á–µ–π–∫–∞ #10 (–¥–µ–Ω—å 6, –∏–Ω–¥–µ–∫—Å 10):', row.children[10]?.textContent, row.children[10]);
                                console.log('  –Ø—á–µ–π–∫–∞ #11 (–¥–µ–Ω—å 7, –∏–Ω–¥–µ–∫—Å 11):', row.children[11]?.textContent, row.children[11]);
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —è—á–µ–π–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç "–†–∞–±–æ—Ç–∞"
                                let foundWork = false;
                                Array.from(row.children).forEach((cell, idx) => {
                                    if (cell.textContent && cell.textContent.trim() === '–†–∞–±–æ—Ç–∞') {
                                        console.warn(`‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–∞ —è—á–µ–π–∫–∞ #${idx} —Å —Ç–µ–∫—Å—Ç–æ–º "–†–∞–±–æ—Ç–∞":`, cell.textContent, cell);
                                        foundWork = true;
                                    }
                                });
                                if (!foundWork) {
                                    console.log('‚úÖ –Ø—á–µ–π–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º "–†–∞–±–æ—Ç–∞" –Ω–∞–π–¥–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–ª–æ–Ω–∫–µ "–î–µ–π—Å—Ç–≤–∏–µ" (–∏–Ω–¥–µ–∫—Å 4)');
                                }
                            }
                        }, 100);
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 500ms –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ
                        setTimeout(() => {
                            const row = tbody.querySelector('tr:first-child');
                            if (row) {
                                const cell10 = row.children[10];
                                const cell11 = row.children[11];
                                if (cell10 && cell10.textContent && cell10.textContent.trim() === '–†–∞–±–æ—Ç–∞') {
                                    console.error('‚ùå –û–®–ò–ë–ö–ê: –Ø—á–µ–π–∫–∞ #10 (–¥–µ–Ω—å 6) —Å–æ–¥–µ—Ä–∂–∏—Ç "–†–∞–±–æ—Ç–∞" –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏!', cell10);
                                }
                                if (cell11 && cell11.textContent && cell11.textContent.trim() === '–†–∞–±–æ—Ç–∞') {
                                    console.error('‚ùå –û–®–ò–ë–ö–ê: –Ø—á–µ–π–∫–∞ #11 (–¥–µ–Ω—å 7) —Å–æ–¥–µ—Ä–∂–∏—Ç "–†–∞–±–æ—Ç–∞" –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏!', cell11);
                                }
                            }
                        }, 500);
                    }
                });
                
                updateDayTotals();
            }
            
            function calcRowPercent(habit){
                const st = loadState();
                let sum = 0;
                let denom = 0;
                const now = new Date();
                const sameYear = (now.getFullYear() === YEAR);
                let maxDay = DAYS.length;
                if (sameYear) {
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    const todayIndex = DAYS.findIndex(d => {
                        const dDate = new Date(d.year, d.month, d.day);
                        return dDate.getTime() === today.getTime();
                    });
                    if (todayIndex >= 0) {
                        maxDay = todayIndex + 1; // +1 –ø–æ—Ç–æ–º—É —á—Ç–æ day –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1
                    }
                }
                for (let d = 1; d <= maxDay; d++) {
                    if (isActiveDay(habit, d)) {
                        denom++;
                        if (st[`${habit}__${d}`] === true) sum++;
                    }
                }
                if (denom === 0) return 0;
                return Math.round((sum / denom) * 100);
            }

            function updateRowPercent(tr, habit){
                const cells = tr.querySelectorAll('td');
                const percentVal = calcRowPercent(habit);
                const percentTd = cells[cells.length-1];
                percentTd.textContent = percentVal + '%';
            }

            function computeDayPercent(day){
                const st = loadState();
                const activeHabits = habits.filter(h => isActiveDay(h, day));
                const active = activeHabits.length;
                if(active === 0) return 0;
                let done = 0;
                activeHabits.forEach(h => { if(st[`${h}__${day}`] === true) done++; });
                return Math.round((done / active) * 100);
            }

            function updateDayTotals(){
                const totalRow = document.getElementById('year-tracker-total');
                if (!totalRow) return;
                
                DAYS.forEach((dayObj, dayIndex) => {
                    const day = dayIndex + 1;
                    const cell = totalRow.children[dayIndex + 5];
                    if (cell) {
                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã
                        cell.textContent = '';
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–µ—Ä–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏
                        const isActive = habits.length > 0 ? isActiveDay(habits[0], day) : false;
                        if (isActive) {
                            cell.style.background = '#e3f2fd'; // –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (–ø–Ω-–ø—Ç)
                        } else {
                            cell.style.background = '#f5f5f5'; // –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏ (—Å–±-–≤—Å)
                        }
                    }
                });
                
                const tbody = document.getElementById('year-tracker-body');
                const rows = tbody.querySelectorAll('tr');
                let totalSum = 0;
                let totalCount = 0;
                
                rows.forEach(row => {
                    const lastCell = row.lastElementChild;
                    if (lastCell && lastCell.classList.contains('percent')) {
                        const percentText = lastCell.textContent.trim();
                        const percent = parseInt(percentText);
                        if (!isNaN(percent)) {
                            totalSum += percent;
                            totalCount++;
                        }
                    }
                });
                
                const totalCell = totalRow.children[totalRow.children.length - 1];
                if (totalCell && totalCount > 0) {
                    const avg = Math.round(totalSum / totalCount);
                    totalCell.textContent = avg + '%';
                }
            }
            
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–∑—É –∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–°–µ–≥–æ–¥–Ω—è"
            buildYearTrackerTable();
            
            // –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–°–µ–≥–æ–¥–Ω—è"
            const originalShowSection = window.showSection;
            if (originalShowSection) {
                window.showSection = function(sectionName) {
                    originalShowSection(sectionName);
                    if (sectionName === 'today') {
                        setTimeout(() => {
                            const headerRow = document.getElementById('year-tracker-header');
                            if (headerRow && headerRow.innerHTML === '') {
                                buildYearTrackerTable();
                            }
                        }, 200);
                    }
                };
            }
        })();
    </script>
</body>
</html>

